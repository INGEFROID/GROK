<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAMA ECCP - G√©n√©rateur de Soumissions Frigorifiques</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#181818'
                    }
                }
            }
        }
    </script>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900">
    <!-- Mode sombre automatique -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            event.matches ? document.documentElement.classList.add('dark') : document.documentElement.classList.remove('dark');
        });
    </script>

    <div id="app" class="h-full flex flex-col">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <h1 id="brandName" class="text-2xl font-bold text-primary">Ing√©Froid</h1>
                            <p id="brandSubtitle" class="text-sm text-gray-600 dark:text-gray-400">Bureau d'√©tude en r√©frig√©ration</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="newProjectBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Nouveau Projet
                        </button>
                        <button id="saveProjectBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors" style="display: none;">
                            <i class="fas fa-save mr-2"></i>Sauvegarder
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Contenu principal -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Vue liste des projets -->
            <div id="projectsList" class="flex-1 p-6">
                <div class="max-w-6xl mx-auto">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Mes Projets</h2>
                        <p class="text-gray-600 dark:text-gray-400">G√©rez vos soumissions frigorifiques</p>
                    </div>

                    <!-- Message de bienvenue -->
                    <div class="bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-6 mb-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle text-blue-400 text-xl"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-lg font-medium text-blue-900 dark:text-blue-100">
                                    Bienvenue dans LAMA ECCP
                                </h3>
                                <p class="mt-2 text-blue-700 dark:text-blue-200">
                                    Cr√©ez vos premi√®res soumissions frigorifiques professionnelles en quelques clics. 
                                    Commencez par cr√©er un nouveau projet.
                                </p>
                                <div class="mt-4">
                                    <button onclick="createNewProject()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-rocket mr-2"></i>Cr√©er mon premier projet
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Projets existants -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projectsGrid">
                        <!-- Les projets seront ajout√©s dynamiquement -->
                    </div>
                </div>
            </div>

            <!-- Vue √©diteur de projet -->
            <div id="projectEditor" class="flex-1 flex overflow-hidden" style="display: none;">
                <!-- Navigation lat√©rale -->
                <div class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 overflow-y-auto">
                    <div class="p-4">
                        <button id="backToProjectsBtn" class="w-full flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white mb-6">
                            <i class="fas fa-arrow-left mr-2"></i>Retour aux projets
                        </button>
                        
                        <!-- S√©lecteur de mode global -->
                        <div class="mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Mode projet :</label>
                            <select id="globalMode" class="w-full text-sm p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="toggleGlobalMode()">
                                <option value="bureau">üèóÔ∏è Bureau d'√©tudes</option>
                                <option value="soumission">üìã Interface soumissionnaire</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Affecte tous les chapitres</p>
                        </div>

                        <nav class="space-y-2">
                            <button class="nav-btn w-full text-left p-3 rounded-lg" data-section="general">
                                <i class="fas fa-info-circle mr-3"></i>Informations g√©n√©rales
                            </button>
                            <button class="nav-btn w-full text-left p-3 rounded-lg" data-section="raccordements">
                                <i class="fas fa-plug mr-3"></i>Raccordements postes
                            </button>
                            <button class="nav-btn w-full text-left p-3 rounded-lg" data-section="chambres">
                                <i class="fas fa-cube mr-3"></i>Chambres froides
                            </button>
                            <button class="nav-btn w-full text-left p-3 rounded-lg" data-section="evaporateurs">
                                <i class="fas fa-snowflake mr-3"></i>√âvaporateurs
                            </button>
                            <button class="nav-btn w-full text-left p-3 rounded-lg" data-section="production">
                                <i class="fas fa-industry mr-3"></i>Production frigorifique
                            </button>
                            <button class="nav-btn w-full text-left p-3 rounded-lg" data-section="apercu">
                                <i class="fas fa-eye mr-3"></i>Aper√ßu & Export
                            </button>
                        </nav>
                    </div>
                </div>

                <!-- Contenu de l'√©diteur -->
                <div class="flex-1 overflow-y-auto">
                    <!-- Section Informations g√©n√©rales -->
                    <div id="section-general" class="section-content p-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Informations g√©n√©rales</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 space-y-6">
                            <!-- S√©lecteur de marque -->
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Marque / Bureau d'√©tudes</label>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                        <input type="radio" name="brandSelection" value="ingefroid" class="mr-3" checked onchange="changeBrand('ingefroid')">
                                        <div>
                                            <div class="font-medium text-blue-700 dark:text-blue-300">Ing√©Froid</div>
                                            <div class="text-xs text-gray-600 dark:text-gray-400">Bureau d'√©tude ind√©pendant</div>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                        <input type="radio" name="brandSelection" value="lama-eccp" class="mr-3" onchange="changeBrand('lama-eccp')">
                                        <div>
                                            <div class="font-medium text-purple-700 dark:text-purple-300">LAMA ECCP</div>
                                            <div class="text-xs text-gray-600 dark:text-gray-400">Bureau d'√©tudes partenaire</div>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nom du projet</label>
                                    <input type="text" id="projectName" class="w-full text-base p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: Installation Universit√© de Neuch√¢tel">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Client</label>
                                    <input type="text" id="clientName" class="w-full text-base p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: Universit√© de Neuch√¢tel">
                                </div>
                            </div>
                            
                            <!-- Configuration globale des r√©frig√©rants -->
                            <div class="bg-blue-50 dark:bg-blue-900 rounded-lg p-4 mb-4">
                                <h4 class="font-medium text-blue-900 dark:text-blue-100 mb-3">
                                    üå°Ô∏è Configuration globale des r√©frig√©rants
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-blue-800 dark:text-blue-200 mb-2">R√©frig√©rant circuit positif</label>
                                        <select id="refrigerantPositif" class="w-full text-base p-3 border border-blue-300 dark:border-blue-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-blue-800 dark:text-white" onchange="updateGlobalRefrigerants()">
                                            <option value="R513A">R513A (HFO/HFC - A1)</option>
                                            <option value="R454C">R454C (HFO/HFC - A2L)</option>
                                            <option value="R455A">R455A (HFO/HFC - A2L)</option>
                                            <option value="R744">R744 (CO‚ÇÇ - A1)</option>
                                            <option value="R448A">R448A (HFO/HFC - A1)</option>
                                            <option value="R449A">R449A (HFO/HFC - A1)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-blue-800 dark:text-blue-200 mb-2">R√©frig√©rant circuit n√©gatif</label>
                                        <select id="refrigerantNegatif" class="w-full text-base p-3 border border-blue-300 dark:border-blue-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-blue-800 dark:text-white" onchange="updateGlobalRefrigerants()">
                                            <option value="R454C">R454C (HFO/HFC - A2L)</option>
                                            <option value="R455A">R455A (HFO/HFC - A2L)</option>
                                            <option value="R513A">R513A (HFO/HFC - A1)</option>
                                            <option value="R744">R744 (CO‚ÇÇ - A1)</option>
                                            <option value="R448A">R448A (HFO/HFC - A1)</option>
                                            <option value="R449A">R449A (HFO/HFC - A1)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-3 p-3 bg-white dark:bg-blue-800 rounded text-sm">
                                    <div class="flex items-center space-x-4">
                                        <div class="flex items-center">
                                            <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                            <span class="text-green-800 dark:text-green-200">A1 = Non inflammable</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="inline-block w-3 h-3 bg-orange-500 rounded-full mr-2"></span>
                                            <span class="text-orange-800 dark:text-orange-200">A2L = Faiblement inflammable</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description du projet</label>
                                <textarea id="projectDescription" rows="4" class="w-full text-base p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white" placeholder="D√©crivez votre projet frigorifique..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Section Chambres froides -->
                    <div id="section-chambres" class="section-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Chambres froides</h2>
                            <button id="addChambreBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Ajouter une chambre
                            </button>
                        </div>

                        <div id="chambresContainer" class="space-y-6">
                            <!-- Les chambres seront ajout√©es dynamiquement -->
                        </div>
                    </div>

                    <!-- Section Raccordements -->
                    <div id="section-raccordements" class="section-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Raccordements postes</h2>
                            <button id="addRaccordementBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Ajouter un raccordement
                            </button>
                        </div>

                        <div id="racordementsContainer" class="space-y-6">
                            <!-- Les raccordements seront ajout√©s dynamiquement -->
                        </div>
                    </div>

                    <!-- Section √âvaporateurs -->
                    <div id="section-evaporateurs" class="section-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">√âvaporateurs</h2>
                            <button id="addEvaporateurBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Ajouter un √©vaporateur
                            </button>
                        </div>

                        <div id="evaporateursContainer" class="space-y-6">
                            <!-- Les √©vaporateurs seront ajout√©s dynamiquement -->
                        </div>
                    </div>

                    <!-- Section Production frigorifique -->
                    <div id="section-production" class="section-content p-6" style="display: none;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Production frigorifique</h2>
                            <button id="addProductionBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Ajouter une production
                            </button>
                        </div>

                        <div id="productionContainer" class="space-y-6">
                            <!-- Les productions seront ajout√©es dynamiquement -->
                        </div>
                    </div>

                    <!-- Section Aper√ßu -->
                    <div id="section-apercu" class="section-content p-6" style="display: none;">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Aper√ßu & Export</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                            <p class="text-gray-600 dark:text-gray-400 text-center py-8">
                                Aper√ßu du projet sera affich√© ici
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Templates pour les composants -->
    <template id="chambre-template">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 chambre-item" data-id="">
            <div class="flex justify-between items-start mb-4">
                <h3 class="chambre-title text-lg font-semibold text-gray-900 dark:text-white">Position - Chambre froide</h3>
                <button class="text-red-600 hover:text-red-800 delete-btn" onclick="deleteChambre(this)">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <!-- Configuration de base -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Configuration</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Position</label>
                        <input type="text" class="position-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: 8.01" oninput="updateChambreTitle(this.closest('.chambre-item'))">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nom</label>
                        <input type="text" class="nom-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: Chambre froide positive" oninput="updateChambreTitle(this.closest('.chambre-item'))">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type</label>
                        <select class="type-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="updateChambreTitle(this.closest('.chambre-item'))">
                            <option value="positive">Positive</option>
                            <option value="negative">N√©gative</option>
                            <option value="boissons">Boissons</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Dimensions ext√©rieures (L x P x H mm)</label>
                        <input type="text" class="dimensions-ext-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: 3400 x 2400 x 2600" oninput="calculateInteriorDimensions(this.closest('.chambre-item')); syncReferenceValues(this.closest('.chambre-item')); syncDimensionsToSpec(this.closest('.chambre-item'))">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Dimensions int√©rieures (L x P x H mm)</label>
                        <div class="flex">
                            <input type="text" class="dimensions-int-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded-l focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-600" placeholder="Calcul√© automatiquement" readonly>
                            <button type="button" class="edit-interior-btn px-3 py-2 bg-gray-200 dark:bg-gray-600 border border-l-0 border-gray-300 dark:border-gray-600 rounded-r hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors" onclick="toggleInteriorEdit(this)" title="√âditer manuellement">
                                <i class="fas fa-edit text-sm"></i>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Calcul√© automatiquement - Cliquez pour √©diter si sp√©cialit√©</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">√âpaisseur isolation (mm)</label>
                        <select class="isolation-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="calculateInteriorDimensions(this.closest('.chambre-item')); syncReferenceValues(this.closest('.chambre-item'))">
                            <option value="100">100 mm (positive)</option>
                            <option value="160">160 mm (n√©gative)</option>
                            <option value="120">120 mm (mixte)</option>
                            <option value="200">200 mm (sp√©cial)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type de porte</label>
                        <select class="porte-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="syncReferenceValues(this.closest('.chambre-item'))">
                            <option value="battant">Battant</option>
                            <option value="coulissante">Coulissante</option>
                            <option value="sectionnelle">Sectionnelle</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Vide passage (L x H mm)</label>
                        <input type="text" class="passage-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: 800 x 2000" oninput="syncReferenceValues(this.closest('.chambre-item'))">
                    </div>
                </div>
            </div>

            <!-- Tableau de validation soumissionnaire -->
            <div class="border-t pt-4">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium text-gray-900 dark:text-white">Validation soumissionnaire</h4>
                    <div class="text-xs text-gray-500 flex items-center space-x-4">
                        <span class="flex items-center"><span class="w-3 h-3 bg-green-100 border border-green-300 rounded mr-1"></span>Conforme (&lt;20%)</span>
                        <span class="flex items-center"><span class="w-3 h-3 bg-orange-100 border border-orange-300 rounded mr-1"></span>Attention (20-30%)</span>
                        <span class="flex items-center"><span class="w-3 h-3 bg-red-100 border border-red-300 rounded mr-1"></span>Critique (&gt;30%)</span>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-300 dark:border-gray-600">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Crit√®re</th>
                                <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Vos sp√©cifications</th>
                                <th class="p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">R√©ponse soumissionnaire</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Dimensions ext. (L√óP√óH mm)</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="dimensions-ext-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 3400 x 2400 x 2600" oninput="syncToReference(this, 'dimensions-ext-ref')">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'dimensions-ext')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="dimensions-ext-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ou saisissez vos valeurs" oninput="validateChambreInputs(this.closest('.chambre-item'))">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Dimensions int. (L√óP√óH mm)</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-400 dimensions-int-ref">-</td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'dimensions-int')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="dimensions-int-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: 3300 x 2200 x 2400" oninput="validateChambreInputs(this.closest('.chambre-item'))">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">√âpaisseur isolation (mm)</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-400 isolation-ref">-</td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'isolation')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" class="isolation-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="100 ou 160" oninput="validateChambreInputs(this.closest('.chambre-item'))">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type de porte</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-400 porte-ref">-</td>
                                <td class="p-2">
                                    <select class="porte-supplier w-full border-0 bg-transparent text-sm rounded p-1" onchange="validateChambreInputs(this.closest('.chambre-item'))">
                                        <option value="">S√©lectionner...</option>
                                        <option value="battant">Battant</option>
                                        <option value="coulissante">Coulissante</option>
                                    </select>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Vide passage (L√óH mm)</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-400 passage-ref">-</td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'passage')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="passage-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: 800 x 2000" oninput="validateChambreInputs(this.closest('.chambre-item'))">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Plinthes de protection</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="plinthes-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="oui">Oui - Incluses</option>
                                        <option value="non">Non - Non incluses</option>
                                        <option value="option">En option</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'plinthes')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <select class="plinthes-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                                <option value="">S√©lectionner...</option>
                                                <option value="oui">Oui - Incluses</option>
                                                <option value="non">Non - Non incluses</option>
                                                <option value="option">En option</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Marque propos√©e</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="marque-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: Mercatus, Arneg, Epta..." value="Libre choix">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'marque')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="marque-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Mercatus, Arneg, Epta...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type de lumi√®re</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="lumiere-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: LED, Fluorescent..." value="LED">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'lumiere')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="lumiere-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: LED, Fluorescent...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type de sol</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="sol-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: R√©sine, Inox, Dalle..." value="R√©sine antid√©rapante">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'sol')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="sol-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: R√©sine, Inox, Dalle...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type de plinthes de finition</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="plinthes-finition-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: Aluminium, Inox..." value="Aluminium">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'plinthes-finition')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="plinthes-finition-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Aluminium, Inox...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">ML plinthes de protection</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="number" step="0.1" class="ml-plinthes-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="M√®tres">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'ml-plinthes')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" step="0.1" class="ml-plinthes-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="M√®tres" oninput="validateChambreInputs(this.closest('.chambre-item'))">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Classe antid√©rapante</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="classe-antiderapante-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="R9">R9</option>
                                        <option value="R10">R10</option>
                                        <option value="R11" selected>R11</option>
                                        <option value="R12">R12</option>
                                        <option value="R13">R13</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'classe-antiderapante')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <select class="classe-antiderapante-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                                <option value="">S√©lectionner...</option>
                                                <option value="R9">R9</option>
                                                <option value="R10">R10</option>
                                                <option value="R11">R11</option>
                                                <option value="R12">R12</option>
                                                <option value="R13">R13</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">R√©sistance du sol</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="resistance-sol-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 5000 kg/m¬≤" value="5000 kg/m¬≤">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'resistance-sol')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="resistance-sol-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: 5000 kg/m¬≤">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type de fermeture</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="fermeture-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="poignee">Poign√©e standard</option>
                                        <option value="levier">Levier ergonomique</option>
                                        <option value="automatique">Fermeture automatique</option>
                                        <option value="magnetique">Magn√©tique</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'fermeture')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <select class="fermeture-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                                <option value="">S√©lectionner...</option>
                                                <option value="poignee">Poign√©e standard</option>
                                                <option value="levier">Levier ergonomique</option>
                                                <option value="automatique">Fermeture automatique</option>
                                                <option value="magnetique">Magn√©tique</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Pays de provenance</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="pays-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: Suisse, Allemagne, France..." value="Union Europ√©enne">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'pays')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="pays-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Suisse, Allemagne, France...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Coefficient U (W/m¬≤¬∑K)</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="number" step="0.01" class="coeff-u-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="0.35" value="0.35">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'coeff-u')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" step="0.01" class="coeff-u-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="0.25" oninput="validateChambreInputs(this.closest('.chambre-item'))">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-100 dark:bg-blue-900">Prix livr√© pos√© HT</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-100 dark:bg-blue-900 text-gray-600 dark:text-gray-400"></td>
                                <td class="p-2 bg-blue-50 dark:bg-blue-800"><input type="text" class="prix-supplier w-full border-0 bg-transparent text-sm font-medium rounded p-1" placeholder="CHF 25'000.00" oninput="formatCHF(this)"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Section √©quipements sp√©ciaux personnalisables -->
            <div class="border-t pt-6 mt-6">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium text-gray-900 dark:text-white">√âquipements sp√©ciaux</h4>
                    <button class="add-custom-field-btn text-sm bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 px-3 py-1 rounded hover:bg-green-200 dark:hover:bg-green-800 transition-colors" onclick="addCustomField(this.closest('.chambre-item'))">
                        <i class="fas fa-plus mr-1"></i>Ajouter un champ
                    </button>
                </div>
                <div class="custom-fields-container space-y-3">
                    <!-- Les champs personnalis√©s seront ajout√©s ici -->
                </div>
                <p class="text-xs text-gray-500 mt-2">Maximum 4 champs personnalis√©s (rampes d'acc√®s, trappes de visite, etc.)</p>
            </div>
        </div>
    </template>

    <template id="custom-field-template">
        <div class="custom-field bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3">
            <div class="flex items-center justify-between mb-2">
                <h5 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Champ personnalis√©</h5>
                <button class="text-red-600 hover:text-red-800 text-sm" onclick="deleteCustomField(this)">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
                <div>
                    <input type="text" class="custom-name w-full text-sm p-2 border border-yellow-300 dark:border-yellow-600 rounded bg-white dark:bg-gray-800 dark:text-white" placeholder="Nom (ex: Rampe d'acc√®s)" oninput="updateCustomFieldValidation(this.closest('.custom-field'))">
                </div>
                <div>
                    <select class="custom-unit w-full text-sm p-2 border border-yellow-300 dark:border-yellow-600 rounded bg-white dark:bg-gray-800 dark:text-white">
                        <option value="">Unit√©</option>
                        <option value="pi√®ces">pi√®ces</option>
                        <option value="m√®tres">m√®tres</option>
                        <option value="m¬≤">m¬≤</option>
                        <option value="kg">kg</option>
                        <option value="‚Ç¨">‚Ç¨</option>
                        <option value="CHF">CHF</option>
                        <option value="-">-</option>
                    </select>
                </div>
                <div>
                    <input type="text" class="custom-spec w-full text-sm p-2 border border-yellow-300 dark:border-yellow-600 rounded bg-white dark:bg-gray-800 dark:text-white" placeholder="Votre sp√©cification" oninput="updateCustomFieldValidation(this.closest('.custom-field'))">
                </div>
                <div>
                    <input type="text" class="custom-response w-full text-sm p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 dark:text-white" placeholder="R√©ponse soumissionnaire" oninput="validateCustomField(this.closest('.custom-field'))">
                </div>
            </div>
            <div class="custom-validation-display text-xs"></div>
        </div>
    </template>

    <template id="raccordement-template">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 raccordement-item" data-id="">
            <div class="flex justify-between items-start mb-4">
                <h3 class="raccordement-title text-lg font-semibold text-gray-900 dark:text-white">Position - Raccordement frigo</h3>
                <button class="text-red-600 hover:text-red-800 delete-btn" onclick="deleteRaccordement(this)">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <!-- Configuration de base -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Configuration</h4>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Position</label>
                        <input type="text" class="position-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: 2.03 FC" oninput="updateRaccordementTitle(this.closest('.raccordement-item'))">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <input type="text" class="description-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: Raccordement frigo inf√©rieur 3 blocs" oninput="updateRaccordementTitle(this.closest('.raccordement-item'))">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type de temp√©rature</label>
                        <select class="type-temperature-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="updateRaccordementTitle(this.closest('.raccordement-item'))">
                            <option value="positive">Positive</option>
                            <option value="negative">N√©gative</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Fluide frigorig√®ne</label>
                        <select class="fluide-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="updateFluideDependentFields(this.closest('.evaporateur-item'))">
                            <option value="R513A">R513A</option>
                            <option value="R454C">R454C</option>
                            <option value="R455A">R455A</option>
                            <option value="R744">R744 (CO‚ÇÇ)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tableau de validation soumissionnaire -->
            <div class="border-t pt-4">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium text-gray-900 dark:text-white">Validation soumissionnaire</h4>
                    <div class="text-xs text-gray-500 flex items-center space-x-4">
                        <span class="flex items-center"><span class="w-3 h-3 bg-green-100 border border-green-300 rounded mr-1"></span>Conforme (&lt;20%)</span>
                        <span class="flex items-center"><span class="w-3 h-3 bg-orange-100 border border-orange-300 rounded mr-1"></span>Attention (20-30%)</span>
                        <span class="flex items-center"><span class="w-3 h-3 bg-red-100 border border-red-300 rounded mr-1"></span>Critique (&gt;30%)</span>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-300 dark:border-gray-600">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Crit√®re</th>
                                <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Vos sp√©cifications</th>
                                <th class="p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">R√©ponse soumissionnaire</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Puissance frigorifique</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="puissance-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: -10/+45¬∞C" value="-10/+45¬∞C">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'puissance')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="puissance-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: 1.2 kW">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Marque du d√©tendeur</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="marque-detendeur-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: Danfoss, Emerson..." value="Libre choix">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'marque-detendeur')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="marque-detendeur-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Danfoss, Emerson...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type du d√©tendeur</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="type-detendeur-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="thermostatique" selected>Thermostatique</option>
                                        <option value="electronique">√âlectronique</option>
                                        <option value="capillaire">Capillaire</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'type-detendeur')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="type-detendeur-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: TXV, EXV...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Marque de la vanne magn√©tique</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="marque-vanne-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: Danfoss, Parker..." value="Libre choix">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'marque-vanne')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="marque-vanne-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Danfoss, Parker...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type de la vanne magn√©tique</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="type-vanne-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="nc" selected>Normalement ferm√©e (NC)</option>
                                        <option value="no">Normalement ouverte (NO)</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'type-vanne')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="type-vanne-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: NC, NO...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type des vannes d'arr√™t (aspiration-liquide)</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="vannes-arret-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: Boisseau, Papillon..." value="√Ä boisseau sph√©rique">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'vannes-arret')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="vannes-arret-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Boisseau, Papillon...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Montage des composants</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="montage-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="regles-art" selected>Selon r√®gles de l'art</option>
                                        <option value="plan-specifique">Selon plan sp√©cifique</option>
                                        <option value="norme-fabricant">Selon norme fabricant</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <select class="montage-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                        <option value="">S√©lectionner...</option>
                                        <option value="compris">Compris</option>
                                        <option value="non-compris">Non compris</option>
                                        <option value="obligatoire">Obligatoire</option>
                                    </select>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">√âtiquetage des composants</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="etiquetage-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="selon-plans" selected>Selon plans</option>
                                        <option value="numerotation-standard">Num√©rotation standard</option>
                                        <option value="marquage-fabricant">Marquage fabricant</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <select class="etiquetage-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                        <option value="">S√©lectionner...</option>
                                        <option value="compris">Compris</option>
                                        <option value="non-compris">Non compris</option>
                                        <option value="obligatoire">Obligatoire</option>
                                    </select>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Mise en service et essais</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="essais-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="protocoles-complets" selected>Protocoles complets</option>
                                        <option value="essais-fonctionnels">Essais fonctionnels</option>
                                        <option value="verification-base">V√©rification de base</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <select class="essais-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                        <option value="">S√©lectionner...</option>
                                        <option value="compris">Compris</option>
                                        <option value="non-compris">Non compris</option>
                                        <option value="obligatoire">Obligatoire</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-100 dark:bg-blue-900">Prix livr√© pos√© HT</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-100 dark:bg-blue-900 text-gray-600 dark:text-gray-400"></td>
                                <td class="p-2 bg-blue-50 dark:bg-blue-800"><input type="text" class="w-full border-0 bg-transparent text-sm font-medium rounded p-1" placeholder="CHF"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </template>

    <template id="evaporateur-template">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 evaporateur-item" data-id="">
            <div class="flex justify-between items-start mb-4">
                <h3 class="evaporateur-title text-lg font-semibold text-gray-900 dark:text-white">Position - Partie frigotechnique</h3>
                <button class="text-red-600 hover:text-red-800 delete-btn" onclick="deleteEvaporateur(this)">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <!-- Suggestion √©quipement bas√© sur les donn√©es Roller -->
            <div class="bg-blue-50 dark:bg-blue-900 rounded p-4 mb-4">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-medium text-blue-900 dark:text-blue-100">üí° Suggestion √©quipement</h4>
                    <button class="applySuggestion text-blue-600 hover:text-blue-800 text-sm" onclick="applySuggestion(this)">Appliquer</button>
                </div>
                <div class="text-sm text-blue-800 dark:text-blue-200">
                    <p><strong>Roller DLKT 612 EC</strong> - Capacit√©: 1.284 kW - R513A</p>
                    <p>2 ventilateurs EC, 1248 m¬≥/h, 33 dB(A) √† 10m</p>
                </div>
            </div>

            <!-- Configuration de base -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Configuration</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Position</label>
                        <input type="text" class="position-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: 8.01E ou 8.02E" oninput="updateEvaporateurTitle(this.closest('.evaporateur-item'))">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <input type="text" class="description-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: Partie frigotechnique chambre froide positive" oninput="updateEvaporateurTitle(this.closest('.evaporateur-item'))">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type de temp√©rature</label>
                        <select class="type-temperature-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="toggleNegativeFields(this.closest('.evaporateur-item')); updateEvaporateurTitle(this.closest('.evaporateur-item'))">
                            <option value="positive">Positive</option>
                            <option value="negative">N√©gative</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Association chambre froide</label>
                        <select class="chambre-associee-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="syncChambreData(this.closest('.evaporateur-item'))">
                            <option value="">S√©lectionner une chambre...</option>
                            <!-- Options g√©n√©r√©es dynamiquement -->
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Liaison automatique avec les donn√©es chambre</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Fluide frigorig√®ne</label>
                        <select class="fluide-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="updateFluideDependentFields(this.closest('.evaporateur-item'))">
                            <option value="R513A">R513A</option>
                            <option value="R454C">R454C</option>
                            <option value="R455A">R455A</option>
                            <option value="R744">R744 (CO‚ÇÇ)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tableau de validation soumissionnaire -->
            <div class="border-t pt-4">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium text-gray-900 dark:text-white">Validation soumissionnaire</h4>
                    <div class="text-xs text-gray-500 flex items-center space-x-4">
                        <span class="flex items-center"><span class="w-3 h-3 bg-green-100 border border-green-300 rounded mr-1"></span>Conforme (&lt;20%)</span>
                        <span class="flex items-center"><span class="w-3 h-3 bg-orange-100 border border-orange-300 rounded mr-1"></span>Attention (20-30%)</span>
                        <span class="flex items-center"><span class="w-3 h-3 bg-red-100 border border-red-300 rounded mr-1"></span>Critique (&gt;30%)</span>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-300 dark:border-gray-600">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Crit√®re</th>
                                <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Vos sp√©cifications</th>
                                <th class="p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">R√©ponse soumissionnaire</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Marque</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="marque-evap-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: Roller, G√ºntner..." value="Libre choix">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'marque-evap')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="marque-evap-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Roller, G√ºntner...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Type</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="type-evap-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="plafonnier" selected>√âvaporateur plafonnier</option>
                                        <option value="mural">√âvaporateur mural</option>
                                        <option value="sol">√âvaporateur au sol</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'type-evap')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="type-evap-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Plafonnier, Mural...">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <!-- Champ sp√©cial pour n√©gatif -->
                            <tr class="border-b border-gray-300 dark:border-gray-600 negative-only-field" style="display: none;">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-yellow-50 dark:bg-yellow-900">Pression de service Max.</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-yellow-50 dark:bg-yellow-900 text-gray-600 dark:text-gray-400 pression-spec">35 Bar</td>
                                <td class="p-2 bg-yellow-50 dark:bg-yellow-900"><input type="text" class="w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Bar"></td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Dimensions</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="dimensions-evap-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 800x600x400 mm" value="Selon chambre">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'dimensions-evap')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="dimensions-evap-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Millim√®tres">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">√âcartement d'ailettes</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="ailettes-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 6-8 mm" value="6-8 mm">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'ailettes')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="ailettes-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Millim√®tres">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Puissance frigorifique</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="puissance-evap-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 1.2 kW" value="Selon calcul">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'puissance-evap')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" step="0.01" class="puissance-evap-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="kW">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Temp√©rature d'entr√©e d'air</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="temp-entree-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: +5¬∞C" value="Selon type">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'temp-entree')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" class="temp-entree-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="¬∞C">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Temp√©rature d'√©vaporation</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="temp-evaporation-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: -10¬∞C" value="-10¬∞C / -29¬∞C">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'temp-evaporation')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" class="temp-evaporation-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="¬∞C">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Surface d'√©change</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="surface-echange-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 12.5 m¬≤" value="Optimis√©e">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'surface-echange')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" step="0.1" class="surface-echange-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="m2">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Contenance des tubes</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="contenance-tubes-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 2.8 dm¬≥" value="Minimale">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'contenance-tubes')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" step="0.1" class="contenance-tubes-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="dm3">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Nombre de ventilateur</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="nb-ventilateur-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 2 pi√®ces" value="Optimis√©">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'nb-ventilateur')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" class="nb-ventilateur-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Pi√®ce">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Puissance absorb√©e ventilateur</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="puissance-ventilateur-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 95 W" value="EC optimis√©">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'puissance-ventilateur')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" class="puissance-ventilateur-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="W">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <!-- Champ sp√©cial pour n√©gatif -->
                            <tr class="border-b border-gray-300 dark:border-gray-600 negative-only-field" style="display: none;">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-yellow-50 dark:bg-yellow-900">Puissance de d√©givrage</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-yellow-50 dark:bg-yellow-900 text-gray-600 dark:text-gray-400">√âlectrique</td>
                                <td class="p-2 bg-yellow-50 dark:bg-yellow-900"><input type="number" step="0.1" class="w-full border-0 bg-transparent text-sm rounded p-1" placeholder="kW"></td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">D√©bit d'air</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="debit-air-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 1248 m¬≥/h" value="Optimis√©">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'debit-air')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" class="debit-air-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="M3/h">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Vitesse de rotation</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="vitesse-rotation-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 1350 tr/min" value="Variable">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'vitesse-rotation')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="vitesse-rotation-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="T/minutes">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Niveau sonore √† 10 m√®tres</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="niveau-sonore-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 33 dB(A)" value="‚â§ 35 dB(A)">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'niveau-sonore')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" class="niveau-sonore-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="dB(A)">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Puissance sonore</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <input type="text" class="puissance-sonore-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" placeholder="Ex: 45 dB(A)" value="‚â§ 45 dB(A)">
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'puissance-sonore')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="number" class="puissance-sonore-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="dB(A)">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">D√©tendeur et orifice</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="detendeur-orifice-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="inclus" selected>Inclus</option>
                                        <option value="non-inclus">Non inclus</option>
                                        <option value="option">En option</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'detendeur-orifice')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="detendeur-orifice-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Vanne magn√©tique</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="vanne-magnetique-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="incluse" selected>Incluse</option>
                                        <option value="non-incluse">Non incluse</option>
                                        <option value="option">En option</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'vanne-magnetique')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="vanne-magnetique-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Tableau satellite et sondes</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="tableau-satellite-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="inclus" selected>Inclus</option>
                                        <option value="non-inclus">Non inclus</option>
                                        <option value="option">En option</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'tableau-satellite')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="tableau-satellite-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <!-- Champ sp√©cial pour n√©gatif -->
                            <tr class="border-b border-gray-300 dark:border-gray-600 negative-only-field" style="display: none;">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-yellow-50 dark:bg-yellow-900">D√©tecteur</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-yellow-50 dark:bg-yellow-900 text-gray-600 dark:text-gray-400 detecteur-spec">A2l R454C</td>
                                <td class="p-2 bg-yellow-50 dark:bg-yellow-900">
                                    <select class="detecteur-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                        <option value="">S√©lectionner...</option>
                                        <option value="A2l-R454C">D√©tecteur A2l R454C</option>
                                        <option value="A2l-R455A">D√©tecteur A2l R455A</option>
                                        <option value="CO2-R744">D√©tecteur CO‚ÇÇ R744</option>
                                        <option value="non-inclus">Non inclus</option>
                                    </select>
                                </td>
                            </tr>
                            <!-- Champ sp√©cial pour n√©gatif -->
                            <tr class="border-b border-gray-300 dark:border-gray-600 negative-only-field" style="display: none;">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-yellow-50 dark:bg-yellow-900">Panneaux lumineux ne pas entrer / veuillez sortir</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-yellow-50 dark:bg-yellow-900 text-gray-600 dark:text-gray-400">Selon s√©curit√©</td>
                                <td class="p-2 bg-yellow-50 dark:bg-yellow-900"><input type="text" class="w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Inclus/Non inclus"></td>
                            </tr>
                            <!-- Champ sp√©cial pour n√©gatif -->
                            <tr class="border-b border-gray-300 dark:border-gray-600 negative-only-field" style="display: none;">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-yellow-50 dark:bg-yellow-900">Alarme sonore 90 dB(A)</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-yellow-50 dark:bg-yellow-900 text-gray-600 dark:text-gray-400">Obligatoire</td>
                                <td class="p-2 bg-yellow-50 dark:bg-yellow-900"><input type="text" class="w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Inclus/Non inclus"></td>
                            </tr>
                                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Fixation et raccordement</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="fixation-raccordement-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="inclus" selected>Inclus</option>
                                        <option value="non-inclus">Non inclus</option>
                                        <option value="option">En option</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'fixation-raccordement')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="fixation-raccordement-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Compris/Non compris">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">√âtiquetages</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="etiquetages-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="selon-plans" selected>Selon plans</option>
                                        <option value="numerotation-standard">Num√©rotation standard</option>
                                        <option value="non-inclus">Non inclus</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'etiquetages')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="etiquetages-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Compris/Non compris">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-300 dark:border-gray-600">
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-gray-50 dark:bg-gray-700">Mise en service et essais</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-gray-50 dark:bg-gray-700">
                                    <select class="mise-service-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400">
                                        <option value="">S√©lectionnez...</option>
                                        <option value="protocoles-complets" selected>Protocoles complets</option>
                                        <option value="essais-fonctionnels">Essais fonctionnels</option>
                                        <option value="verification-base">V√©rification de base</option>
                                    </select>
                                </td>
                                <td class="p-2">
                                    <div class="soumissionnaire-response">
                                        <div class="flex items-center space-x-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, 'mise-service')">
                                                <span class="text-xs">‚úì Spec</span>
                                            </label>
                                            <input type="text" class="mise-service-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Compris/Non compris">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-100 dark:bg-blue-900">Prix livr√© pos√© HT</td>
                                <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-100 dark:bg-blue-900 text-gray-600 dark:text-gray-400"></td>
                                <td class="p-2 bg-blue-50 dark:bg-blue-800"><input type="text" class="w-full border-0 bg-transparent text-sm font-medium rounded p-1" placeholder="CHF"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </template>

    <!-- Template Production frigorifique -->
    <template id="production-template">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 production-item" data-id="">
            <div class="flex justify-between items-start mb-4">
                <h3 class="production-title text-lg font-semibold text-gray-900 dark:text-white">Production frigorifique</h3>
                <button class="text-red-600 hover:text-red-800 delete-btn" onclick="deleteProduction(this)">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <!-- S√©lecteur de type et configuration de base -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Type de production frigorifique</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">S√©lectionner le type :</label>
                        <select class="type-production-input w-full text-base p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" onchange="switchProductionType(this.closest('.production-item'))">
                            <option value="">-- Choisir un type --</option>
                            <option value="positif-seul">‚ùÑÔ∏è Positif seul</option>
                            <option value="negatif-seul">üßä N√©gatif seul</option>
                            <option value="positif-negatif-separes">üîÄ Positif + N√©gatif (circuits s√©par√©s)</option>
                            <option value="cascade">üîÑ CASCADE (Positif + N√©gatif interconnect√©s)</option>
                            <option value="booster-co2">üå°Ô∏è BOOSTER CO‚ÇÇ (Transcritique)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Position</label>
                        <input type="text" class="position-production-input w-full text-base p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: 6.13 ou 8.1" oninput="updateProductionTitle(this.closest('.production-item'))">
                    </div>
                </div>
            </div>

            <!-- Contenu sp√©cifique CASCADE (masqu√© par d√©faut) -->
            <div class="cascade-content" style="display: none;">
                <!-- Configuration CASCADE -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900 dark:to-purple-900 rounded-lg p-4 mb-6">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-3 cascade-title">
                        <i class="fas fa-layer-group mr-2"></i>Configuration CASCADE R513A / R454C
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                            <input type="text" class="description-cascade-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: Production frigorifique trois compresseurs" oninput="updateProductionTitle(this.closest('.production-item'))">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Dimensions</label>
                            <input type="text" class="dimensions-cascade-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: 1200 x 800 x 1000 mm">
                        </div>
                    </div>
                    
                    <!-- Configuration flexible des compresseurs -->
                    <div class="bg-white dark:bg-gray-800 rounded p-3 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <h5 class="text-sm font-medium text-gray-800 dark:text-gray-200">üèóÔ∏è Configuration des compresseurs</h5>
                            <div class="text-xs text-gray-500">Adaptez selon votre projet</div>
                        </div>
                        
                        <!-- CIRCUIT POSITIF -->
                        <div class="mb-4 p-3 bg-green-50 dark:bg-green-900/20 rounded">
                            <div class="flex items-center justify-between mb-2">
                                <h6 class="text-sm font-medium text-green-800 dark:text-green-200">‚ûï Circuit Positif</h6>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-green-600 nb-comp-pos-display">3 compresseurs</span>
                                    <button type="button" class="remove-comp-pos text-red-600 hover:text-red-800 text-lg" onclick="removeCompressor(this.closest('.production-item'), 'positif')" title="Retirer un compresseur">‚àí</button>
                                    <button type="button" class="add-comp-pos text-green-600 hover:text-green-800 text-lg" onclick="addCompressor(this.closest('.production-item'), 'positif')" title="Ajouter un compresseur">+</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-xs compressors-positif-list">
                                <div class="comp-pos-item">Comp. #1: <strong>Bitzer CD0 38-2.5H</strong></div>
                                <div class="comp-pos-item">Comp. #2: <strong>Bitzer CD0 25-2.5H</strong></div>
                                <div class="comp-pos-item">Comp. #3: <strong>Bitzer CD0 25-2.5H</strong></div>
                            </div>
                        </div>
                        
                        <!-- CIRCUIT N√âGATIF -->
                        <div class="mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                            <div class="flex items-center justify-between mb-2">
                                <h6 class="text-sm font-medium text-blue-800 dark:text-blue-200">‚ùÑÔ∏è Circuit N√©gatif</h6>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-blue-600 nb-comp-neg-display">1 compresseur</span>
                                    <button type="button" class="remove-comp-neg text-red-600 hover:text-red-800 text-lg" onclick="removeCompressor(this.closest('.production-item'), 'negatif')" title="Retirer un compresseur">‚àí</button>
                                    <button type="button" class="add-comp-neg text-blue-600 hover:text-blue-800 text-lg" onclick="addCompressor(this.closest('.production-item'), 'negatif')" title="Ajouter un compresseur">+</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-xs compressors-negatif-list">
                                <div class="comp-neg-item">Comp. #1: <strong>Bitzer CD0 10.5H</strong></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Param√®tres techniques CASCADE - DYNAMIQUES -->
                    <div class="bg-white dark:bg-gray-800 rounded p-3 mb-4">
                        <h5 class="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2">‚öôÔ∏è Param√®tres techniques (synchronis√©s depuis le tableau)</h5>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-xs cascade-params-display">
                            <div><span class="text-gray-600 dark:text-gray-400">√âvap. positif:</span> <strong class="temp-evap-pos-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">√âvap. n√©gatif:</span> <strong class="temp-evap-neg-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Cond. positif:</span> <strong class="temp-cond-pos-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Cond. n√©gatif:</span> <strong class="temp-cond-neg-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Freq. min:</span> <strong class="freq-min-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Freq. max:</span> <strong class="freq-max-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Puiss. pos:</span> <strong class="puiss-evap-pos-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Puiss. n√©g:</span> <strong class="puiss-evap-neg-display">-</strong></div>
                        </div>
                        <p class="text-xs text-blue-600 dark:text-blue-400 mt-2">üí° Ces valeurs se mettent √† jour automatiquement selon vos saisies dans le tableau de validation</p>
                    </div>
                </div>
            </div>

            <!-- Contenu sp√©cifique BOOSTER CO2 (masqu√© par d√©faut) -->
            <div class="booster-content" style="display: none;">
                <!-- Configuration BOOSTER CO2 -->
                <div class="bg-gradient-to-r from-green-50 to-teal-50 dark:from-green-900 dark:to-teal-900 rounded-lg p-4 mb-6">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-3 booster-title">
                        <i class="fas fa-industry mr-2"></i>Configuration BOOSTER CO‚ÇÇ R744
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                            <input type="text" class="description-booster-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: Centrale frigorifique 3 compresseurs semi-herm√©tique au R744" oninput="updateProductionTitle(this.closest('.production-item'))">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Dimensions (cm)</label>
                            <input type="text" class="dimensions-booster-input w-full text-base p-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Ex: 180 x 120 x 160 cm">
                        </div>
                    </div>
                    
                    <!-- Configuration flexible des compresseurs BOOSTER -->
                    <div class="bg-white dark:bg-gray-800 rounded p-3 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <h5 class="text-sm font-medium text-gray-800 dark:text-gray-200">üèóÔ∏è Configuration des compresseurs BOOSTER</h5>
                            <div class="text-xs text-gray-500">CO‚ÇÇ R744 - Adaptez selon votre projet</div>
                        </div>
                        
                        <!-- CIRCUIT POSITIF BOOSTER -->
                        <div class="mb-4 p-3 bg-green-50 dark:bg-green-900/20 rounded">
                            <div class="flex items-center justify-between mb-2">
                                <h6 class="text-sm font-medium text-green-800 dark:text-green-200">‚ûï Circuit Positif BOOSTER</h6>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-green-600 nb-comp-pos-booster-display">3 compresseurs</span>
                                    <button type="button" class="remove-comp-pos-booster text-red-600 hover:text-red-800 text-lg" onclick="removeCompressorBooster(this.closest('.production-item'), 'positif')" title="Retirer un compresseur">‚àí</button>
                                    <button type="button" class="add-comp-pos-booster text-green-600 hover:text-green-800 text-lg" onclick="addCompressorBooster(this.closest('.production-item'), 'positif')" title="Ajouter un compresseur">+</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-xs compressors-positif-booster-list">
                                <div class="comp-pos-booster-item">Comp. #1: <strong>Bitzer CD0 38-3.0H</strong></div>
                                <div class="comp-pos-booster-item">Comp. #2: <strong>Bitzer CD0 38-3.0H</strong></div>
                                <div class="comp-pos-booster-item">Comp. #3: <strong>Bitzer CD0 38-3.0H</strong></div>
                            </div>
                        </div>
                        
                        <!-- CIRCUIT N√âGATIF BOOSTER -->
                        <div class="mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
                            <div class="flex items-center justify-between mb-2">
                                <h6 class="text-sm font-medium text-blue-800 dark:text-blue-200">‚ùÑÔ∏è Circuit N√©gatif BOOSTER</h6>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-blue-600 nb-comp-neg-booster-display">1 compresseur</span>
                                    <button type="button" class="remove-comp-neg-booster text-red-600 hover:text-red-800 text-lg" onclick="removeCompressorBooster(this.closest('.production-item'), 'negatif')" title="Retirer un compresseur">‚àí</button>
                                    <button type="button" class="add-comp-neg-booster text-blue-600 hover:text-blue-800 text-lg" onclick="addCompressorBooster(this.closest('.production-item'), 'negatif')" title="Ajouter un compresseur">+</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-xs compressors-negatif-booster-list">
                                <div class="comp-neg-booster-item">Comp. #1: <strong>Bitzer CD0 25-2.5H</strong></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Param√®tres techniques BOOSTER - DYNAMIQUES SYNCHRONIS√âS -->
                    <div class="bg-white dark:bg-gray-800 rounded p-3 mb-4">
                        <h5 class="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2">‚öôÔ∏è Param√®tres techniques (synchronis√©s depuis le tableau)</h5>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-xs booster-params-display">
                            <div><span class="text-gray-600 dark:text-gray-400">√âvaporation:</span> <strong class="temp-evap-booster-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">GazCooler:</span> <strong class="temp-gc-booster-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Pression GC:</span> <strong class="pression-gc-booster-display">92 Bar</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Fr√©quence max:</span> <strong class="freq-max-booster-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Puiss. √©vap:</span> <strong class="puiss-evap-booster-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Puiss. abs:</span> <strong class="puiss-abs-booster-display">-</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">Simultan√©it√©:</span> <strong class="simultaneite-booster-display">88%</strong></div>
                            <div><span class="text-gray-600 dark:text-gray-400">HP Max:</span> <strong class="hp-max-booster-display">-</strong></div>
                        </div>
                        <p class="text-xs text-green-600 dark:text-green-400 mt-2">üí° Ces valeurs se mettent √† jour automatiquement selon vos saisies dans le tableau de validation</p>
                    </div>
                    
                    
            <!-- Message de s√©lection (affich√© par d√©faut) -->
            <div class="selection-message bg-gray-100 dark:bg-gray-800 rounded-lg p-8 text-center">
                <i class="fas fa-hand-point-up text-4xl text-gray-400 mb-4"></i>
                <h4 class="text-lg font-medium text-gray-600 dark:text-gray-400 mb-2">S√©lectionnez un type de production</h4>
                <p class="text-sm text-gray-500 dark:text-gray-500">Choisissez entre CASCADE R513A/R454C ou BOOSTER CO‚ÇÇ pour afficher les sp√©cifications techniques d√©taill√©es.</p>
            </div>

            <!-- Tableau de validation soumissionnaire (affich√© apr√®s s√©lection) -->
            <div class="validation-section" style="display: none;">
                <div class="border-t pt-6">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-medium text-gray-900 dark:text-white">Validation soumissionnaire</h4>
                        <div class="text-xs text-gray-500 flex items-center space-x-4">
                            <span class="flex items-center"><span class="w-3 h-3 bg-green-100 border border-green-300 rounded mr-1"></span>Conforme (&lt;20%)</span>
                            <span class="flex items-center"><span class="w-3 h-3 bg-orange-100 border border-orange-300 rounded mr-1"></span>Attention (20-30%)</span>
                            <span class="flex items-center"><span class="w-3 h-3 bg-red-100 border border-red-300 rounded mr-1"></span>Critique (&gt;30%)</span>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border border-gray-300 dark:border-gray-600 validation-table">
                            <!-- Le contenu du tableau sera inject√© dynamiquement -->
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        // Variables globales (pas de localStorage dans le Canvas)
        let currentProject = null;
        let projects = {};
        
        // Configuration des marques
        const brandingConfig = {
            "ingefroid": {
                name: "Ing√©Froid",
                subtitle: "Bureau d'√©tude en r√©frig√©ration",
                colors: { primary: "#2563eb", secondary: "#1e40af" },
                contact: "contact@ingefroid.ch",
                description: "Solutions frigorifiques sur mesure"
            },
            "lama-eccp": {
                name: "LAMA ECCP", 
                subtitle: "G√©n√©rateur de Soumissions Frigorifiques",
                colors: { primary: "#5D5CDE", secondary: "#181818" },
                contact: "info@lama-eccp.ch",
                description: "Bureau d'√©tudes frigorifiques"
            }
        };
        
        let currentBrand = 'ingefroid'; // Marque par d√©faut

        // Gestion de l'interface
        function showProjectsList() {
            document.getElementById('projectsList').style.display = 'block';
            document.getElementById('projectEditor').style.display = 'none';
            document.getElementById('saveProjectBtn').style.display = 'none';
            updateProjectsGrid();
        }

        function showProjectEditor() {
            document.getElementById('projectsList').style.display = 'none';
            document.getElementById('projectEditor').style.display = 'flex';
            document.getElementById('saveProjectBtn').style.display = 'block';
            showSection('general');
        }

        function showSection(sectionName) {
            // Masquer toutes les sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.style.display = 'none';
            });
            
            // Retirer la classe active de tous les boutons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
            });
            
            // Afficher la section s√©lectionn√©e
            document.getElementById(`section-${sectionName}`).style.display = 'block';
            
            // Ajouter la classe active au bouton correspondant
            const activeBtn = document.querySelector(`[data-section="${sectionName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('bg-primary', 'text-white');
                activeBtn.classList.remove('text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
            }
        }

        // Gestion des projets
        function createNewProject() {
            currentProject = {
                id: 'project_' + Date.now(),
                name: '',
                client: '',
                description: '',
                createdAt: new Date().toISOString(),
                modifiedAt: new Date().toISOString()
            };
            showProjectEditor();
        }

        function saveProject() {
            saveCurrentProject();
        }

        function loadProject(projectId) {
            currentProject = projects[projectId];
            if (!currentProject) return;
            
            showProjectEditor();
            
            // Charger les informations g√©n√©rales
            document.getElementById('projectName').value = currentProject.name || '';
            document.getElementById('clientName').value = currentProject.client || '';
            document.getElementById('projectDescription').value = currentProject.description || '';
            
            // Charger les chambres froides
            if (currentProject.chambres) {
                currentProject.chambres.forEach(chambreData => {
                    addChambre();
                    const lastChambre = document.querySelector('.chambre-item:last-child');
                    lastChambre.dataset.id = chambreData.id;
                    
                    lastChambre.querySelector('.position-input').value = chambreData.position || '';
                    lastChambre.querySelector('.nom-input').value = chambreData.nom || '';
                    lastChambre.querySelector('.type-input').value = chambreData.type || 'positive';
                    lastChambre.querySelector('.dimensions-ext-input').value = chambreData.dimensionsExt || '';
                    lastChambre.querySelector('.dimensions-int-input').value = chambreData.dimensionsInt || '';
                    lastChambre.querySelector('.isolation-input').value = chambreData.isolation || '100';
                    lastChambre.querySelector('.porte-input').value = chambreData.porte || 'battant';
                    lastChambre.querySelector('.passage-input').value = chambreData.passage || '';
                    
                    // Mettre √† jour le titre et synchroniser les r√©f√©rences
                    updateChambreTitle(lastChambre);
                    syncReferenceValues(lastChambre);
                });
            }
            
            // Charger les raccordements
            if (currentProject.raccordements) {
                currentProject.raccordements.forEach(raccordementData => {
                    addRaccordement();
                    const lastRaccordement = document.querySelector('.raccordement-item:last-child');
                    lastRaccordement.dataset.id = raccordementData.id;
                    
                    lastRaccordement.querySelector('.position-input').value = raccordementData.position || '';
                    lastRaccordement.querySelector('.description-input').value = raccordementData.description || '';
                    lastRaccordement.querySelector('.type-temperature-input').value = raccordementData.typeTemperature || 'positive';
                    lastRaccordement.querySelector('.fluide-input').value = raccordementData.fluide || 'R513A';
                    
                    // Mettre √† jour le titre
                    updateRaccordementTitle(lastRaccordement);
                });
            }
            
            // Charger les √©vaporateurs
            if (currentProject.evaporateurs) {
                currentProject.evaporateurs.forEach(evaporateurData => {
                    addEvaporateur();
                    const lastEvaporateur = document.querySelector('.evaporateur-item:last-child');
                    lastEvaporateur.dataset.id = evaporateurData.id;
                    
                    lastEvaporateur.querySelector('.position-input').value = evaporateurData.position || '';
                    lastEvaporateur.querySelector('.description-input').value = evaporateurData.description || '';
                    lastEvaporateur.querySelector('.type-temperature-input').value = evaporateurData.typeTemperature || 'positive';
                    lastEvaporateur.querySelector('.chambre-associee-input').value = evaporateurData.chambreAssociee || '';
                    lastEvaporateur.querySelector('.fluide-input').value = evaporateurData.fluide || 'R513A';
                    
                    // Mettre √† jour le titre et les champs sp√©ciaux
                    updateEvaporateurTitle(lastEvaporateur);
                    toggleNegativeFields(lastEvaporateur);
                });
            }
            
            // Mettre √† jour les options de chambres apr√®s chargement
            setTimeout(() => {
                updateChambreOptions();
            }, 100);
        }

        function deleteProject(projectId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">√ätes-vous s√ªr de vouloir supprimer ce projet ?</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" onclick="this.closest('.fixed').remove()">Annuler</button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded" onclick="this.closest('.fixed').remove(); confirmDeleteProject('${projectId}')">Supprimer</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmDeleteProject(projectId) {
            delete projects[projectId];
            showNotification('Projet supprim√©', 'success');
            updateProjectsGrid();
        }

        function updateProjectsGrid() {
            const grid = document.getElementById('projectsGrid');
            grid.innerHTML = '';
            
            Object.values(projects).forEach(project => {
                const projectCard = document.createElement('div');
                projectCard.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow p-6 cursor-pointer border border-gray-200 dark:border-gray-700';
                projectCard.onclick = () => loadProject(project.id);
                
                const modifiedDate = new Date(project.modifiedAt).toLocaleDateString('fr-FR');
                
                projectCard.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">${project.name}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${project.client || 'Client non d√©fini'}</p>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                            En cours
                        </span>
                    </div>
                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                        Modifi√© le ${modifiedDate}
                    </div>
                    <div class="flex space-x-2">
                        <button class="text-primary hover:text-primary/80" onclick="event.stopPropagation(); loadProject('${project.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-800" onclick="event.stopPropagation(); deleteProject('${project.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                grid.appendChild(projectCard);
            });
        }

        // Gestion des chambres froides
        function addChambre() {
            const template = document.getElementById('chambre-template');
            const clone = template.content.cloneNode(true);
            const item = clone.querySelector('.chambre-item');
            item.dataset.id = 'chambre_' + Date.now();
            
            // Synchroniser les valeurs de r√©f√©rence quand l'utilisateur modifie ses sp√©cifications
            const inputs = item.querySelectorAll('.dimensions-ext-input, .isolation-input, .porte-input');
            inputs.forEach(input => {
                input.addEventListener('change', () => syncReferenceValues(item));
            });
            
            document.getElementById('chambresContainer').appendChild(clone);
        }

        // Calcul automatique des dimensions int√©rieures
        function calculateInteriorDimensions(chambreElement) {
            const dimExtInput = chambreElement.querySelector('.dimensions-ext-input');
            const isolationInput = chambreElement.querySelector('.isolation-input');
            const dimIntInput = chambreElement.querySelector('.dimensions-int-input');
            
            if (!dimExtInput.value || !isolationInput.value) return;
            
            // Parser les dimensions ext√©rieures (format: "L x P x H")
            const extMatch = dimExtInput.value.match(/(\d+)\s*x\s*(\d+)\s*x\s*(\d+)/);
            if (!extMatch) return;
            
            const [, extL, extP, extH] = extMatch.map(Number);
            const isolation = parseInt(isolationInput.value);
            
            // Calcul : L et P perdent 2√ó√©paisseur, H perd 1√ó√©paisseur
            const intL = extL - (2 * isolation);
            const intP = extP - (2 * isolation); 
            const intH = extH - isolation;
            
            // V√©rifier que les dimensions restent positives
            if (intL > 0 && intP > 0 && intH > 0) {
                dimIntInput.value = `${intL} x ${intP} x ${intH}`;
                dimIntInput.classList.remove('border-red-300', 'bg-red-50');
            } else {
                dimIntInput.value = 'Erreur - Isolation trop √©paisse';
                dimIntInput.classList.add('border-red-300', 'bg-red-50');
            }
            
            // Synchroniser avec les r√©f√©rences
            syncReferenceValues(chambreElement);
        }

        // Activer/d√©sactiver l'√©dition manuelle des dimensions int√©rieures  
        function toggleInteriorEdit(button) {
            const dimIntInput = button.closest('div').querySelector('.dimensions-int-input');
            const icon = button.querySelector('i');
            
            if (dimIntInput.readOnly) {
                // Activer l'√©dition manuelle
                dimIntInput.readOnly = false;
                dimIntInput.classList.remove('bg-gray-100', 'dark:bg-gray-600');
                dimIntInput.classList.add('bg-white', 'dark:bg-gray-700');
                icon.className = 'fas fa-calculator text-sm';
                button.title = 'Recalculer automatiquement';
                button.classList.add('bg-orange-200', 'dark:bg-orange-600');
            } else {
                // Retour au calcul automatique
                dimIntInput.readOnly = true;
                dimIntInput.classList.add('bg-gray-100', 'dark:bg-gray-600');
                dimIntInput.classList.remove('bg-white', 'dark:bg-gray-700');
                icon.className = 'fas fa-edit text-sm';
                button.title = '√âditer manuellement';
                button.classList.remove('bg-orange-200', 'dark:bg-orange-600');
                
                // Recalculer automatiquement
                calculateInteriorDimensions(button.closest('.chambre-item'));
            }
        }

        // Mettre √† jour le titre dynamique de la chambre
        function updateChambreTitle(chambreElement) {
            const position = chambreElement.querySelector('.position-input').value;
            const nom = chambreElement.querySelector('.nom-input').value;
            const type = chambreElement.querySelector('.type-input').value;
            
            const title = chambreElement.querySelector('.chambre-title');
            
            let titleText = '';
            if (position) titleText += `Position ${position}`;
            if (position && nom) titleText += ' - ';
            if (nom) titleText += nom;
            if (!position && !nom) titleText = 'Chambre froide';
            
            title.textContent = titleText;
        }

        function syncReferenceValues(chambreElement) {
            // Synchroniser dimensions ext√©rieures
            const dimExtInput = chambreElement.querySelector('.dimensions-ext-input');
            const dimExtRef = chambreElement.querySelector('.dimensions-ext-ref');
            if (dimExtInput && dimExtRef) {
                dimExtRef.textContent = dimExtInput.value || '-';
            }

            // Synchroniser dimensions int√©rieures
            const dimIntInput = chambreElement.querySelector('.dimensions-int-input');
            const dimIntRef = chambreElement.querySelector('.dimensions-int-ref');
            if (dimIntInput && dimIntRef) {
                dimIntRef.textContent = dimIntInput.value || '-';
            }

            // Synchroniser √©paisseur isolation
            const isolationInput = chambreElement.querySelector('.isolation-input');
            const isolationRef = chambreElement.querySelector('.isolation-ref');
            if (isolationInput && isolationRef) {
                isolationRef.textContent = isolationInput.value ? `${isolationInput.value} mm` : '-';
            }

            // Synchroniser type de porte
            const porteInput = chambreElement.querySelector('.porte-input');
            const porteRef = chambreElement.querySelector('.porte-ref');
            if (porteInput && porteRef) {
                porteRef.textContent = porteInput.value || '-';
            }

            // Synchroniser vide passage
            const passageInput = chambreElement.querySelector('.passage-input');
            const passageRef = chambreElement.querySelector('.passage-ref');
            if (passageInput && passageRef) {
                passageRef.textContent = passageInput.value || '-';
            }

            // Re-valider apr√®s synchronisation
            validateChambreInputs(chambreElement);
        }

        // Synchroniser automatiquement les dimensions ext√©rieures vers les sp√©cifications
        function syncDimensionsToSpec(chambreElement) {
            const dimExtInput = chambreElement.querySelector('.dimensions-ext-input');
            const dimExtSpec = chambreElement.querySelector('.dimensions-ext-spec');
            
            if (dimExtInput && dimExtSpec) {
                dimExtSpec.value = dimExtInput.value;
            }
        }

        function deleteChambre(button) {
            button.closest('.chambre-item').remove();
        }

        // Gestion des raccordements
        function addRaccordement() {
            const template = document.getElementById('raccordement-template');
            const clone = template.content.cloneNode(true);
            const item = clone.querySelector('.raccordement-item');
            item.dataset.id = 'raccordement_' + Date.now();
            document.getElementById('racordementsContainer').appendChild(clone);
        }

        function deleteRaccordement(button) {
            button.closest('.raccordement-item').remove();
        }

        // Gestion des √©vaporateurs
        function addEvaporateur() {
            const template = document.getElementById('evaporateur-template');
            const clone = template.content.cloneNode(true);
            const item = clone.querySelector('.evaporateur-item');
            item.dataset.id = 'evaporateur_' + Date.now();
            document.getElementById('evaporateursContainer').appendChild(clone);
        }

        function deleteEvaporateur(button) {
            button.closest('.evaporateur-item').remove();
        }

        // Gestion globale des r√©frig√©rants
        function updateGlobalRefrigerants() {
            const refrigerantPositif = document.getElementById('refrigerantPositif').value;
            const refrigerantNegatif = document.getElementById('refrigerantNegatif').value;
            
            // Appliquer automatiquement dans tous les composants existants
            document.querySelectorAll('.fluide-input').forEach(input => {
                const container = input.closest('.evaporateur-item, .raccordement-item');
                if (container) {
                    const typeTemperature = container.querySelector('.type-temperature-input')?.value;
                    if (typeTemperature === 'positive') {
                        input.value = refrigerantPositif;
                    } else if (typeTemperature === 'negative') {
                        input.value = refrigerantNegatif;
                    }
                }
            });
            
            // Mettre √† jour les titres CASCADE dynamiques
            updateCascadeTitles(refrigerantPositif, refrigerantNegatif);
            
            // Mettre √† jour les tableaux de validation CASCADE existants
            updateCascadeValidationTables(refrigerantPositif, refrigerantNegatif);
            
            // Notification de mise √† jour
            showNotification(`üå°Ô∏è Configuration globale appliqu√©e : ${refrigerantPositif} (positif) / ${refrigerantNegatif} (n√©gatif)`, 'success');
        }

        // Mettre √† jour les titres CASCADE
        function updateCascadeTitles(refrigerantPositif, refrigerantNegatif) {
            document.querySelectorAll('.cascade-title').forEach(title => {
                const icon = title.querySelector('i');
                const iconHtml = icon ? icon.outerHTML : '<i class="fas fa-layer-group mr-2"></i>';
                title.innerHTML = `${iconHtml}Configuration CASCADE ${refrigerantPositif} / ${refrigerantNegatif}`;
            });
        }

        // Mettre √† jour les tableaux CASCADE existants
        function updateCascadeValidationTables(refrigerantPositif, refrigerantNegatif) {
            document.querySelectorAll('.production-item').forEach(production => {
                const typeSelect = production.querySelector('.type-production-input');
                if (typeSelect && typeSelect.value === 'cascade') {
                    // Recharger le tableau avec les nouveaux r√©frig√©rants
                    loadCascadeValidationTable(production, refrigerantPositif, refrigerantNegatif);
                }
            });
        }

        // Gestion du changement de marque
        function changeBrand(brandKey) {
            currentBrand = brandKey;
            const brand = brandingConfig[brandKey];
            
            // Mettre √† jour le header
            document.getElementById('brandName').textContent = brand.name;
            document.getElementById('brandSubtitle').textContent = brand.subtitle;
            
            // Mettre √† jour les couleurs CSS dynamiquement
            const style = document.createElement('style');
            style.textContent = `
                :root {
                    --color-primary: ${brand.colors.primary};
                    --color-secondary: ${brand.colors.secondary};
                }
                .text-primary { color: ${brand.colors.primary} !important; }
                .bg-primary { background-color: ${brand.colors.primary} !important; }
                .border-primary { border-color: ${brand.colors.primary} !important; }
                .focus\\:ring-primary:focus { --tw-ring-color: ${brand.colors.primary}; }
                .focus\\:border-primary:focus { border-color: ${brand.colors.primary}; }
            `;
            
            // Remplacer l'ancien style s'il existe
            const existingStyle = document.getElementById('dynamic-brand-style');
            if (existingStyle) {
                existingStyle.remove();
            }
            style.id = 'dynamic-brand-style';
            document.head.appendChild(style);
            
            showNotification(`Interface mise √† jour pour ${brand.name}`, 'success');
        }

        // Syst√®me de validation avec alertes
        function validateNumericValue(referenceValue, supplierValue, tolerance = 20) {
            if (!referenceValue || !supplierValue) return 'neutral';
            
            const ref = parseFloat(referenceValue);
            const sup = parseFloat(supplierValue);
            
            if (isNaN(ref) || isNaN(sup)) return 'neutral';
            
            const deviation = Math.abs((sup - ref) / ref * 100);
            
            if (deviation <= tolerance) {
                return 'valid'; // Vert - conforme
            } else if (deviation <= tolerance * 1.5) {
                return 'warning'; // Orange - attention
            } else {
                return 'critical'; // Rouge - √©cart critique
            }
        }

        function validateTextValue(referenceValue, supplierValue) {
            if (!referenceValue || !supplierValue) return 'neutral';
            
            const ref = referenceValue.toLowerCase().trim();
            const sup = supplierValue.toLowerCase().trim();
            
            if (ref === sup) {
                return 'valid'; // Vert - identique
            } else {
                return 'warning'; // Orange - diff√©rent
            }
        }

        function applyValidationStyle(element, validationResult) {
            // Supprimer les anciennes classes
            element.classList.remove('bg-green-50', 'border-green-300', 'text-green-800',
                                   'bg-orange-50', 'border-orange-300', 'text-orange-800',
                                   'bg-red-50', 'border-red-300', 'text-red-800');
            
            switch (validationResult) {
                case 'valid':
                    element.classList.add('bg-green-50', 'border-green-300', 'text-green-800');
                    break;
                case 'warning':
                    element.classList.add('bg-orange-50', 'border-orange-300', 'text-orange-800');
                    break;
                case 'critical':
                    element.classList.add('bg-red-50', 'border-red-300', 'text-red-800');
                    break;
                default:
                    // Neutral - pas de style particulier
                    break;
            }
        }

        function validateChambreInputs(chambreElement) {
            // Validation des dimensions ext√©rieures
            const dimExtRef = chambreElement.querySelector('.dimensions-ext-input').value;
            const dimExtSup = chambreElement.querySelector('.dimensions-ext-supplier');
            if (dimExtSup) {
                const validation = validateTextValue(dimExtRef, dimExtSup.value);
                applyValidationStyle(dimExtSup, validation);
            }

            // Validation de l'√©paisseur isolation
            const isolationRef = chambreElement.querySelector('.isolation-input').value;
            const isolationSup = chambreElement.querySelector('.isolation-supplier');
            if (isolationSup) {
                const validation = validateNumericValue(isolationRef, isolationSup.value, 10); // 10% de tolerance
                applyValidationStyle(isolationSup, validation);
            }
        }

        // Gestion des champs personnalisables
        function addCustomField(chambreElement) {
            const container = chambreElement.querySelector('.custom-fields-container');
            const existingFields = container.querySelectorAll('.custom-field');
            
            if (existingFields.length >= 4) {
                showNotification('Maximum 4 champs personnalis√©s autoris√©s', 'warning');
                return;
            }
            
            const template = document.getElementById('custom-field-template');
            const clone = template.content.cloneNode(true);
            container.appendChild(clone);
            
            // Mettre √† jour le bouton d'ajout si limite atteinte
            if (existingFields.length + 1 >= 4) {
                const addBtn = chambreElement.querySelector('.add-custom-field-btn');
                addBtn.disabled = true;
                addBtn.classList.add('opacity-50', 'cursor-not-allowed');
                addBtn.innerHTML = '<i class="fas fa-check mr-1"></i>Maximum atteint';
            }
        }

        function deleteCustomField(button) {
            const customField = button.closest('.custom-field');
            const chambreElement = customField.closest('.chambre-item');
            customField.remove();
            
            // R√©activer le bouton d'ajout
            const addBtn = chambreElement.querySelector('.add-custom-field-btn');
            addBtn.disabled = false;
            addBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            addBtn.innerHTML = '<i class="fas fa-plus mr-1"></i>Ajouter un champ';
        }

        function updateCustomFieldValidation(customField) {
            const name = customField.querySelector('.custom-name').value;
            const unit = customField.querySelector('.custom-unit').value;
            const spec = customField.querySelector('.custom-spec').value;
            
            // Mettre √† jour l'affichage de validation
            const display = customField.querySelector('.custom-validation-display');
            if (name && spec) {
                display.innerHTML = `<span class="text-green-600"><i class="fas fa-check mr-1"></i>Champ configur√©: <strong>${name}</strong> ${unit ? `(${unit})` : ''} - Spec: ${spec}</span>`;
            } else {
                display.innerHTML = '<span class="text-gray-500">Veuillez remplir le nom et la sp√©cification</span>';
            }
        }

        function validateCustomField(customField) {
            const spec = customField.querySelector('.custom-spec').value;
            const response = customField.querySelector('.custom-response').value;
            const unit = customField.querySelector('.custom-unit').value;
            
            if (!spec || !response) return;
            
            // Validation num√©rique si l'unit√© indique une valeur num√©rique
            const numericUnits = ['m√®tres', 'm¬≤', 'kg', '‚Ç¨', 'CHF'];
            if (numericUnits.includes(unit)) {
                const validation = validateNumericValue(spec, response, 20);
                applyValidationStyle(customField.querySelector('.custom-response'), validation);
            } else {
                // Validation textuelle
                const validation = validateTextValue(spec, response);
                applyValidationStyle(customField.querySelector('.custom-response'), validation);
            }
        }

        // Mettre √† jour le titre dynamique du raccordement
        function updateRaccordementTitle(raccordementElement) {
            const position = raccordementElement.querySelector('.position-input').value;
            const description = raccordementElement.querySelector('.description-input').value;
            
            const title = raccordementElement.querySelector('.raccordement-title');
            
            let titleText = '';
            if (position) titleText += `Position ${position}`;
            if (position && description) titleText += ' - ';
            if (description) titleText += description;
            if (!position && !description) titleText = 'Raccordement frigo';
            
            title.textContent = titleText;
        }

        // Mettre √† jour le titre dynamique de l'√©vaporateur
        function updateEvaporateurTitle(evaporateurElement) {
            const position = evaporateurElement.querySelector('.position-input').value;
            const description = evaporateurElement.querySelector('.description-input').value;
            const type = evaporateurElement.querySelector('.type-temperature-input').value;
            
            const title = evaporateurElement.querySelector('.evaporateur-title');
            
            let titleText = '';
            if (position) titleText += `Position ${position}`;
            if (position && description) titleText += ' - ';
            if (description) titleText += description;
            if (!position && !description) titleText = 'Partie frigotechnique';
            if (type) titleText += ` (${type})`;
            
            title.textContent = titleText;
        }

        // Basculer l'affichage des champs sp√©ciaux pour n√©gatif
        function toggleNegativeFields(evaporateurElement) {
            const typeTemperature = evaporateurElement.querySelector('.type-temperature-input').value;
            const negativeFields = evaporateurElement.querySelectorAll('.negative-only-field');
            
            negativeFields.forEach(field => {
                if (typeTemperature === 'negative') {
                    field.style.display = 'table-row';
                } else {
                    field.style.display = 'none';
                }
            });
        }

        // Synchronisation automatique des champs selon le fluide frigorig√®ne
        function updateFluideDependentFields(evaporateurElement) {
            const fluideInput = evaporateurElement.querySelector('.fluide-input');
            if (!fluideInput) return;
            
            const fluide = fluideInput.value;
            const pressionSpec = evaporateurElement.querySelector('.pression-spec');
            const detecteurSpec = evaporateurElement.querySelector('.detecteur-spec');
            const detecteurSupplier = evaporateurElement.querySelector('.detecteur-supplier');
            
            // Configuration selon le fluide
            const fluideConfig = {
                'R744': {
                    pression: '80 Bar',
                    detecteur: 'CO‚ÇÇ R744',
                    detecteurDefault: 'CO2-R744'
                },
                'R454C': {
                    pression: '35 Bar',
                    detecteur: 'A2l R454C',
                    detecteurDefault: 'A2l-R454C'
                },
                'R455A': {
                    pression: '35 Bar',
                    detecteur: 'A2l R455A',
                    detecteurDefault: 'A2l-R455A'
                },
                'R513A': {
                    pression: '35 Bar',
                    detecteur: 'A2l R513A',
                    detecteurDefault: 'A2l-R454C' // Par d√©faut on utilise R454C comme r√©f√©rence
                }
            };
            
            const config = fluideConfig[fluide];
            if (!config) return;
            
            // Mise √† jour des sp√©cifications
            if (pressionSpec) {
                pressionSpec.textContent = config.pression;
            }
            
            if (detecteurSpec) {
                detecteurSpec.textContent = config.detecteur;
            }
            
            // Mise √† jour du menu d√©roulant du d√©tecteur
            if (detecteurSupplier) {
                detecteurSupplier.value = config.detecteurDefault;
            }
            
            // Afficher une notification sur le changement
            showNotification(`Configuration mise √† jour pour ${fluide} : ${config.pression} / ${config.detecteur}`, 'info');
        }

        // Application des suggestions Roller
        function applySuggestion(button) {
            const evaporateurItem = button.closest('.evaporateur-item');
            
            // Donn√©es Roller DLKT 612 EC
            const positionInput = evaporateurItem.querySelector('.position-input');
            const descriptionInput = evaporateurItem.querySelector('.description-input');
            
            if (positionInput) {
                positionInput.value = '8.01E';
            }
            if (descriptionInput) {
                descriptionInput.value = 'Partie frigotechnique chambre froide positive';
            }
            
            // Mettre √† jour le titre
            updateEvaporateurTitle(evaporateurItem);
            
            // Appliquer la configuration fluide par d√©faut (R513A)
            updateFluideDependentFields(evaporateurItem);
            
            showNotification('Suggestion Roller appliqu√©e !', 'success');
        }

        // Fonction globale de basculement de mode
        function toggleGlobalMode() {
            const mode = document.getElementById('globalMode').value;
            
            // Appliquer √† TOUS les chapitres - S√©lecteur corrig√©
            const allItems = document.querySelectorAll('.chambre-item, .raccordement-item, .evaporateur-item');
            
            allItems.forEach(item => {
                const bureauSpecInputs = item.querySelectorAll('.bureau-spec-input');
                const configSection = item.querySelector('.bg-gray-50');
                const soumissionnaireResponses = item.querySelectorAll('.soumissionnaire-response');
                
                if (mode === 'bureau') {
                    // Mode bureau d'√©tudes
                    // 1. Montrer la section de configuration
                    if (configSection) configSection.style.display = 'block';
                    
                    // 2. Activer les champs de sp√©cifications
                    bureauSpecInputs.forEach(input => {
                        input.disabled = false;
                        input.style.backgroundColor = ''; // Reset to normal
                        input.style.color = '';
                        input.style.border = '';
                        input.classList.remove('opacity-50');
                    });
                    
                    // 3. Griser les r√©ponses soumissionnaire
                    soumissionnaireResponses.forEach(response => {
                        const inputs = response.querySelectorAll('input, select');
                        const checkboxes = response.querySelectorAll('.accept-spec-checkbox');
                        
                        inputs.forEach(input => {
                            if (!input.classList.contains('accept-spec-checkbox')) {
                                input.disabled = true;
                                input.style.backgroundColor = '#f3f4f6'; // gray-100
                                input.style.opacity = '0.5';
                            }
                        });
                        
                        checkboxes.forEach(checkbox => {
                            checkbox.disabled = true;
                            checkbox.style.opacity = '0.3';
                        });
                    });
                    
                } else {
                    // Mode soumissionnaire
                    // 1. Masquer la section de configuration
                    if (configSection) configSection.style.display = 'none';
                    
                    // 2. Verrouiller les sp√©cifications en lecture seule
                    bureauSpecInputs.forEach(input => {
                        input.disabled = true;
                        input.style.backgroundColor = '#f3f4f6'; // gray-100
                        input.style.color = '#6b7280'; // gray-500
                        input.style.border = 'none';
                        input.classList.add('opacity-75');
                    });
                    
                    // 3. Activer les r√©ponses soumissionnaire
                    soumissionnaireResponses.forEach(response => {
                        const inputs = response.querySelectorAll('input, select');
                        const checkboxes = response.querySelectorAll('.accept-spec-checkbox');
                        
                        inputs.forEach(input => {
                            if (!input.classList.contains('accept-spec-checkbox')) {
                                input.disabled = false;
                                input.style.backgroundColor = '';
                                input.style.opacity = '1';
                            }
                        });
                        
                        checkboxes.forEach(checkbox => {
                            checkbox.disabled = false;
                            checkbox.style.opacity = '1';
                        });
                    });
                }
            });
            
            // Message de notification selon le mode
            if (mode === 'bureau') {
                showNotification('üèóÔ∏è Mode Bureau d\'√©tudes : D√©finissez vos sp√©cifications techniques', 'info');
            } else {
                showNotification('üìã Mode Soumissionnaire : Validez les specs ou saisissez vos valeurs', 'info');
            }
        }

        // Synchroniser les sp√©cifications bureau vers r√©f√©rence
        function syncToReference(specInput, refClassName) {
            const chambreElement = specInput.closest('.chambre-item');
            const refElement = chambreElement.querySelector(`.${refClassName}`);
            if (refElement) {
                refElement.textContent = specInput.value || '-';
            }
        }

        // Gestion des cases √† cocher "Accepter spec"
        function toggleSpecAcceptance(checkbox, fieldType) {
            const row = checkbox.closest('tr');
            const supplierField = row.querySelector('.soumissionnaire-response input[type="text"], .soumissionnaire-response input[type="number"], .soumissionnaire-response select');
            
            if (checkbox.checked) {
                // R√©cup√©rer la valeur de la sp√©cification du bureau d'√©tudes
                const specCell = row.querySelector('td:nth-child(2)');
                let specValue = '';
                
                // Chercher un input ou select dans la cellule de sp√©cification
                const specInput = specCell.querySelector('input, select');
                if (specInput) {
                    specValue = specInput.value; // ‚úÖ Prendre la VALEUR saisie
                } else {
                    specValue = specCell.textContent.trim(); // Fallback pour le texte statique
                }
                
                if (supplierField && specValue && specValue !== '-') {
                    supplierField.value = specValue;
                    supplierField.disabled = true;
                    supplierField.style.backgroundColor = '#dcfce7'; // green-100
                    supplierField.style.color = '#166534'; // green-800
                    
                    // Validation automatique : conforme
                    applyValidationStyle(supplierField, 'valid');
                }
            } else {
                // Permettre la saisie manuelle
                if (supplierField) {
                    supplierField.value = '';
                    supplierField.disabled = false;
                    supplierField.style.backgroundColor = '';
                    supplierField.style.color = '';
                    
                    // Supprimer la validation
                    applyValidationStyle(supplierField, 'neutral');
                }
            }
        }

        // Synchronisation des chambres froides avec les √©vaporateurs
        function syncChambreData(evaporateurElement) {
            const selectedChambre = evaporateurElement.querySelector('.chambre-associee-input').value;
            if (!selectedChambre) return;
            
            // Trouver la chambre froide correspondante
            const allChambres = document.querySelectorAll('.chambre-item');
            let targetChambre = null;
            
            allChambres.forEach(chambre => {
                const position = chambre.querySelector('.position-input').value;
                const nom = chambre.querySelector('.nom-input').value;
                const chambreId = `${position}-${nom}`;
                
                if (chambreId === selectedChambre) {
                    targetChambre = chambre;
                }
            });
            
            if (!targetChambre) return;
            
            // Synchroniser les donn√©es pertinentes
            const chambreType = targetChambre.querySelector('.type-input').value;
            const chambreDimensions = targetChambre.querySelector('.dimensions-int-input').value;
            
            // Mettre √† jour le type de temp√©rature de l'√©vaporateur
            const evapTypeTemp = evaporateurElement.querySelector('.type-temperature-input');
            if (evapTypeTemp) {
                evapTypeTemp.value = chambreType;
                // D√©clencher le changement pour afficher/masquer les champs sp√©ciaux
                toggleNegativeFields(evaporateurElement);
            }
            
            // Mettre √† jour les sp√©cifications bas√©es sur la chambre
            const dimensionsEvapSpec = evaporateurElement.querySelector('.dimensions-evap-spec');
            if (dimensionsEvapSpec && chambreDimensions) {
                dimensionsEvapSpec.value = `Adapt√© √† ${chambreDimensions}`;
            }
            
            showNotification(`üîó √âvaporateur synchronis√© avec la chambre froide ${selectedChambre}`, 'success');
        }

        // ‚ö†Ô∏è SOLUTION FINALE DUPLICATION - Nettoyage brutal et reconstruction compl√®te
        function updateChambreOptions() {
            console.log('üîÑ NETTOYAGE BRUTAL des options chambres...');
            
            const allEvaporateurs = document.querySelectorAll('.evaporateur-item');
            const allChambres = document.querySelectorAll('.chambre-item');
            
            // üéØ Construire la liste des chambres disponibles UNIQUE
            const chambresDisponibles = new Set(); // Utiliser Set pour √©viter doublons
            const chambresArray = [];
            
            allChambres.forEach(chambre => {
                const position = chambre.querySelector('.position-input')?.value?.trim() || '';
                const nom = chambre.querySelector('.nom-input')?.value?.trim() || '';
                const type = chambre.querySelector('.type-input')?.value || 'positive';
                
                if (position || nom) {
                    const chambreId = `${position}-${nom}`;
                    const displayText = `${position ? `Pos. ${position}` : ''}${position && nom ? ' ' : ''}${nom || 'Sans nom'} (${type})`;
                    
                    // √âviter les doublons avec Set
                    if (!chambresDisponibles.has(chambreId)) {
                        chambresDisponibles.add(chambreId);
                        chambresArray.push({
                            id: chambreId,
                            text: displayText
                        });
                    }
                }
            });
            
            console.log(`üì¶ ${chambresArray.length} chambres uniques trouv√©es`);
            
            // üéØ RECONSTRUCTION COMPL√àTE pour chaque √©vaporateur
            allEvaporateurs.forEach((evaporateur, index) => {
                const selectChambre = evaporateur.querySelector('.chambre-associee-input');
                if (!selectChambre) return;
                
                // Sauvegarder la s√©lection actuelle
                const currentSelection = selectChambre.value;
                
                // ‚ö†Ô∏è DESTRUCTION TOTALE - innerHTML = '' pour √™tre s√ªr
                selectChambre.innerHTML = '';
                
                // Reconstruction manuelle option par option
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'S√©lectionner une chambre...';
                selectChambre.appendChild(defaultOption);
                
                // Ajouter chaque chambre unique
                chambresArray.forEach(chambre => {
                    const option = document.createElement('option');
                    option.value = chambre.id;
                    option.textContent = chambre.text;
                    
                    // Restaurer la s√©lection si elle correspond
                    if (chambre.id === currentSelection) {
                        option.selected = true;
                    }
                    
                    selectChambre.appendChild(option);
                });
                
                console.log(`‚úÖ √âvaporateur ${index + 1}: ${selectChambre.children.length - 1} options ajout√©es`);
            });
            
            console.log('üèÅ Mise √† jour termin√©e');
        }

        // Assurer la mise √† jour des options chambres apr√®s modification
        function ensureChambreOptionsUpdate() {
            // Observer les changements dans les chambres
            const chambresContainer = document.getElementById('chambresContainer');
            if (chambresContainer) {
                const observer = new MutationObserver(() => {
                    setTimeout(updateChambreOptions, 100);
                });
                observer.observe(chambresContainer, { childList: true, subtree: true });
            }
            
            // Mettre √† jour lors des changements de champs
            document.addEventListener('input', (e) => {
                if (e.target.closest('.chambre-item') && 
                    (e.target.classList.contains('position-input') || 
                     e.target.classList.contains('nom-input') || 
                     e.target.classList.contains('type-input'))) {
                    setTimeout(updateChambreOptions, 50);
                }
            });
        }

        // Formatage des prix en CHF
        function formatCHF(input) {
            let value = input.value.replace(/[^\d.,]/g, ''); // Garder seulement chiffres, points et virgules
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            // Remplacer virgule par point pour calculs
            value = value.replace(',', '.');
            
            // Convertir en nombre
            const num = parseFloat(value);
            if (isNaN(num)) {
                return;
            }
            
            // Formater avec s√©parateurs suisses (apostrophes pour milliers, point pour d√©cimales)
            const formatted = num.toLocaleString('de-CH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).replace(/'/g, "'"); // S'assurer d'utiliser l'apostrophe droite
            
            input.value = `CHF ${formatted}`;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 transition-opacity ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                type === 'warning' ? 'bg-orange-600' : 'bg-blue-600'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // ‚ö†Ô∏è CORRECTION PROBL√àME DUPLICATION - Pas de duplication √† la sauvegarde
        function saveCurrentProject() {
            if (!currentProject) return;
            
            try {
                // R√©cup√©rer les informations g√©n√©rales
                currentProject.name = document.getElementById('projectName')?.value || 'Projet sans nom';
                currentProject.client = document.getElementById('clientName')?.value || '';
                currentProject.description = document.getElementById('projectDescription')?.value || '';
                currentProject.refrigerantPositif = document.getElementById('refrigerantPositif')?.value || 'R513A';
                currentProject.refrigerantNegatif = document.getElementById('refrigerantNegatif')?.value || 'R454C';
                currentProject.modifiedAt = new Date().toISOString();
                
                // Sauvegarder la marque s√©lectionn√©e
                const selectedBrand = document.querySelector('input[name="brandSelection"]:checked')?.value;
                currentProject.brandSelection = selectedBrand || 'ingefroid';
                
                // ‚ö†Ô∏è SOLUTION: Remplacer enti√®rement les tableaux existants au lieu d'ajouter
                // Sauvegarder les chambres froides - REMPLACEMENT COMPLET
                currentProject.chambres = [];
                document.querySelectorAll('.chambre-item').forEach(chambre => {
                    const chambreData = {
                        id: chambre.dataset.id,
                        position: chambre.querySelector('.position-input')?.value || '',
                        nom: chambre.querySelector('.nom-input')?.value || '',
                        type: chambre.querySelector('.type-input')?.value || 'positive',
                        dimensionsExt: chambre.querySelector('.dimensions-ext-input')?.value || '',
                        dimensionsInt: chambre.querySelector('.dimensions-int-input')?.value || '',
                        isolation: chambre.querySelector('.isolation-input')?.value || '100',
                        porte: chambre.querySelector('.porte-input')?.value || 'battant',
                        passage: chambre.querySelector('.passage-input')?.value || ''
                    };
                    currentProject.chambres.push(chambreData);
                });
                
                // Sauvegarder les raccordements - REMPLACEMENT COMPLET
                currentProject.raccordements = [];
                document.querySelectorAll('.raccordement-item').forEach(raccordement => {
                    const raccordementData = {
                        id: raccordement.dataset.id,
                        position: raccordement.querySelector('.position-input')?.value || '',
                        description: raccordement.querySelector('.description-input')?.value || '',
                        typeTemperature: raccordement.querySelector('.type-temperature-input')?.value || 'positive',
                        fluide: raccordement.querySelector('.fluide-input')?.value || 'R513A'
                    };
                    currentProject.raccordements.push(raccordementData);
                });
                
                // Sauvegarder les √©vaporateurs - REMPLACEMENT COMPLET
                currentProject.evaporateurs = [];
                document.querySelectorAll('.evaporateur-item').forEach(evaporateur => {
                    const evaporateurData = {
                        id: evaporateur.dataset.id,
                        position: evaporateur.querySelector('.position-input')?.value || '',
                        description: evaporateur.querySelector('.description-input')?.value || '',
                        typeTemperature: evaporateur.querySelector('.type-temperature-input')?.value || 'positive',
                        chambreAssociee: evaporateur.querySelector('.chambre-associee-input')?.value || '',
                        fluide: evaporateur.querySelector('.fluide-input')?.value || 'R513A'
                    };
                    currentProject.evaporateurs.push(evaporateurData);
                });
                
                // Sauvegarder les productions frigorifiques - REMPLACEMENT COMPLET
                currentProject.productions = [];
                document.querySelectorAll('.production-item').forEach(production => {
                    const productionData = {
                        id: production.dataset.id,
                        position: production.querySelector('.position-production-input')?.value || '',
                        type: production.querySelector('.type-production-input')?.value || '',
                        descriptionCascade: production.querySelector('.description-cascade-input')?.value || '',
                        descriptionBooster: production.querySelector('.description-booster-input')?.value || '',
                        dimensionsCascade: production.querySelector('.dimensions-cascade-input')?.value || '',
                        dimensionsBooster: production.querySelector('.dimensions-booster-input')?.value || ''
                    };
                    currentProject.productions.push(productionData);
                });
                
                // ‚ö†Ô∏è SOLUTION DUPLICATION: Remplacer le projet existant par une copie propre
                projects[currentProject.id] = {
                    id: currentProject.id,
                    name: currentProject.name,
                    client: currentProject.client,
                    description: currentProject.description,
                    refrigerantPositif: currentProject.refrigerantPositif,
                    refrigerantNegatif: currentProject.refrigerantNegatif,
                    brandSelection: currentProject.brandSelection,
                    createdAt: currentProject.createdAt,
                    modifiedAt: currentProject.modifiedAt,
                    chambres: [...currentProject.chambres], // Copie immutable
                    raccordements: [...currentProject.raccordements], // Copie immutable
                    evaporateurs: [...currentProject.evaporateurs], // Copie immutable
                    productions: [...currentProject.productions] // Copie immutable
                };
                
                showNotification(`üíæ Projet "${currentProject.name}" sauvegard√© avec succ√®s !`, 'success');
                
            } catch (error) {
                console.error('Erreur lors de la sauvegarde:', error);
                showNotification('‚ùå Erreur lors de la sauvegarde', 'error');
            }
        }

        // === GESTION PRODUCTION FRIGORIFIQUE ===

        // Ajouter une nouvelle production frigorifique
        function addProduction() {
            const template = document.getElementById('production-template');
            const clone = template.content.cloneNode(true);
            const item = clone.querySelector('.production-item');
            item.dataset.id = 'production_' + Date.now();
            document.getElementById('productionContainer').appendChild(clone);
        }

        // Supprimer une production frigorifique
        function deleteProduction(button) {
            button.closest('.production-item').remove();
        }

        // Mettre √† jour le titre de la production
        function updateProductionTitle(productionElement) {
            const position = productionElement.querySelector('.position-production-input').value;
            const typeSelect = productionElement.querySelector('.type-production-input');
            const selectedType = typeSelect.value;
            
            const title = productionElement.querySelector('.production-title');
            
            let titleText = 'Production frigorifique';
            
            if (position) {
                titleText = `Position ${position}`;
            }
            
            // Ajouter la description selon le type s√©lectionn√©
            if (selectedType === 'cascade') {
                const description = productionElement.querySelector('.description-cascade-input')?.value;
                if (description) {
                    titleText += ` - ${description}`;
                } else if (!position) {
                    titleText = 'CASCADE R513A / R454C';
                }
            } else if (selectedType === 'booster-co2') {
                const description = productionElement.querySelector('.description-booster-input')?.value;
                if (description) {
                    titleText += ` - ${description}`;
                } else if (!position) {
                    titleText = 'BOOSTER CO‚ÇÇ R744';
                }
            }
            
            title.textContent = titleText;
        }

        // Basculer entre les types de production
        function switchProductionType(productionElement) {
            const typeSelect = productionElement.querySelector('.type-production-input');
            const selectedType = typeSelect.value;
            
            // Masquer tous les contenus sp√©cifiques
            const cascadeContent = productionElement.querySelector('.cascade-content');
            const boosterContent = productionElement.querySelector('.booster-content');
            const selectionMessage = productionElement.querySelector('.selection-message');
            const validationSection = productionElement.querySelector('.validation-section');
            
            // R√©initialiser l'affichage
            cascadeContent.style.display = 'none';
            boosterContent.style.display = 'none';
            selectionMessage.style.display = 'block';
            validationSection.style.display = 'none';
            
            // Afficher le contenu appropri√© selon la s√©lection
            if (selectedType === 'cascade') {
                cascadeContent.style.display = 'block';
                selectionMessage.style.display = 'none';
                validationSection.style.display = 'block';
                loadCascadeValidationTable(productionElement);
                showNotification('üîÑ Configuration CASCADE charg√©e', 'success');
            } else if (selectedType === 'booster-co2') {
                boosterContent.style.display = 'block';
                selectionMessage.style.display = 'none';
                validationSection.style.display = 'block';
                loadBoosterValidationTable(productionElement);
                showNotification('üå°Ô∏è Configuration BOOSTER CO‚ÇÇ transcritique charg√©e', 'success');
            } else if (selectedType === 'positif-seul' || selectedType === 'negatif-seul' || selectedType === 'positif-negatif-separes') {
                // Pour les autres types, afficher une validation simplifi√©e 
                selectionMessage.style.display = 'none';
                validationSection.style.display = 'block';
                loadSimpleValidationTable(productionElement, selectedType);
                
                const typeNames = {
                    'positif-seul': '‚ùÑÔ∏è Production frigorifique positive seule',
                    'negatif-seul': 'üßä Production frigorifique n√©gative seule', 
                    'positif-negatif-separes': 'üîÄ Circuits positif + n√©gatif s√©par√©s'
                };
                showNotification(`${typeNames[selectedType]} configur√©e`, 'success');
            }
            
            // Mettre √† jour le titre
            updateProductionTitle(productionElement);
        }
                function loadCascadeValidationTable(productionElement, refrigerantPositif = null, refrigerantNegatif = null) {
                if (!refrigerantPositif) refrigerantPositif = document.getElementById('refrigerantPositif')?.value || 'R513A';
                if (!refrigerantNegatif) refrigerantNegatif = document.getElementById('refrigerantNegatif')?.value || 'R454C';
                const validationTable = productionElement.querySelector('.validation-table');
                updateCascadeTitles(refrigerantPositif, refrigerantNegatif);
                validationTable.innerHTML = `
                <!-- üéØ TABLEAU COMPLET CASCADE R513A/R454C NIVEAU PROFESSIONNEL -->
                <thead>
                <tr class="bg-blue-600 text-white">
                    <th colspan="3" class="p-3 text-center font-bold">
                        üîÑ PRODUCTION FRIGORIFIQUE 3 COMPRESSEURS SEMI-HERM√âTIQUE EN CASCADE ${refrigerantPositif} / ${refrigerantNegatif}
                    </th>
                </tr>
                <tr class="bg-gray-100 dark:bg-gray-700">
                    <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Crit√®re technique</th>
                    <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Sp√©cifications bureau d'√©tudes</th>
                    <th class="p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">R√©ponse soumissionnaire</th>
                </tr>
                </thead>
                <tbody class="text-sm">
                <!-- SECTION G√âN√âRALE -->
                <tr class="bg-blue-100 dark:bg-blue-900">
                    <td colspan="3" class="p-2 font-bold text-center text-blue-900 dark:text-blue-100">
                        üìã CARACT√âRISTIQUES G√âN√âRALES
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Marque</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="marque-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Libre choix">
                    </td>
                    <td class="p-2">
                        <input type="text" class="marque-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Bitzer, Dorin, Frascold...">
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Dimensions</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="dimensions-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="1200 x 800 x 1000 mm">
                    </td>
                    <td class="p-2">
                        <input type="text" class="dimensions-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Millim√®tres">
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Mat√©riaux</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="materiaux-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Ch√¢ssis soud√© et peint">
                    </td>
                    <td class="p-2">
                        <input type="text" class="materiaux-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type de mat√©riaux">
                    </td>
                </tr>
            
                <!-- SECTION COMPRESSEURS POSITIFS -->
                <tr class="bg-green-100 dark:bg-green-900">
                    <td colspan="3" class="p-2 font-bold text-center text-green-900 dark:text-green-100">
                        ‚ûï COMPRESSEURS POSITIFS (${refrigerantPositif})
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Type compresseur positif N¬∞1</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="comp-pos-1-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="2FES-2Y (vitesse variable)">
                    </td>
                    <td class="p-2">
                        <input type="text" class="comp-pos-1-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type exact">
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Type compresseur positif N¬∞2</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="comp-pos-2-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="2EES-2Y (vitesse fixe)">
                    </td>
                    <td class="p-2">
                        <input type="text" class="comp-pos-2-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type exact">
                    </td>
                </tr>
            
                <!-- SECTION COMPRESSEUR N√âGATIF -->
                <tr class="bg-indigo-100 dark:bg-indigo-900">
                    <td colspan="3" class="p-2 font-bold text-center text-indigo-900 dark:text-indigo-100">
                        ‚ùÑÔ∏è COMPRESSEUR N√âGATIF (${refrigerantNegatif})
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Type compresseur n√©gatif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="comp-neg-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="2GES-2Y (homologu√© A2L)">
                    </td>
                    <td class="p-2">
                        <input type="text" class="comp-neg-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type exact">
                    </td>
                </tr>
            
                <!-- SECTION PERFORMANCES -->
                <tr class="bg-orange-100 dark:bg-orange-900">
                    <td colspan="3" class="p-2 font-bold text-center text-orange-900 dark:text-orange-100">
                        ‚ö° PERFORMANCES THERMIQUES
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Temp√©rature d'√©vaporation positif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="temp-evap-pos-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="-10" oninput="updateCascadeDisplay(this.closest('.production-item'))">
                            <span class="text-gray-600">¬∞C</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="temp-evap-pos-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="-10">
                            <span class="text-gray-600">¬∞C</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Temp√©rature d'√©vaporation n√©gatif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="temp-evap-neg-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="-30" oninput="updateCascadeDisplay(this.closest('.production-item'))">
                            <span class="text-gray-600">¬∞C</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="temp-evap-neg-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="-30">
                            <span class="text-gray-600">¬∞C</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Temp√©rature de condensation positif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="temp-cond-pos-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="45" oninput="updateCascadeDisplay(this.closest('.production-item'))">
                            <span class="text-gray-600">¬∞C</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="temp-cond-pos-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="45">
                            <span class="text-gray-600">¬∞C</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Temp√©rature de condensation n√©gatif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="temp-cond-neg-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="30" oninput="updateCascadeDisplay(this.closest('.production-item'))">
                            <span class="text-gray-600">¬∞C</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="temp-cond-neg-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="30">
                            <span class="text-gray-600">¬∞C</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Fr√©quence min compresseur positif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="freq-min-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="30" oninput="updateCascadeDisplay(this.closest('.production-item'))">
                            <span class="text-gray-600">Hz</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="freq-min-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="30">
                            <span class="text-gray-600">Hz</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Fr√©quence max compresseur positif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="freq-max-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="70" oninput="updateCascadeDisplay(this.closest('.production-item'))">
                            <span class="text-gray-600">Hz</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="freq-max-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="70">
                            <span class="text-gray-600">Hz</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Fr√©quence compresseur n√©gatif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="freq-neg-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="50">
                            <span class="text-gray-600">Hz</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="freq-neg-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="50">
                            <span class="text-gray-600">Hz</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Puissance √† l'√©vaporateur positif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.01" class="puiss-evap-pos-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="7.29" oninput="updateCascadeDisplay(this.closest('.production-item'))">
                            <span class="text-gray-600">kW</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.01" class="puiss-evap-pos-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="7.29">
                            <span class="text-gray-600">kW</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Puissance absorb√©e positif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.01" class="puiss-abs-pos-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="3.30">
                            <span class="text-gray-600">kW</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.01" class="puiss-abs-pos-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="3.30">
                            <span class="text-gray-600">kW</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Simultan√©it√© positif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="simult-pos-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="102">
                            <span class="text-gray-600">%</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="simult-pos-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="102">
                            <span class="text-gray-600">%</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Puissance √† l'√©vaporateur n√©gatif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.01" class="puiss-evap-neg-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="1.29" oninput="updateCascadeDisplay(this.closest('.production-item'))">
                            <span class="text-gray-600">kW</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.01" class="puiss-evap-neg-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="1.29">
                            <span class="text-gray-600">kW</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Puissance absorb√©e n√©gatif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.01" class="puiss-abs-neg-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="0.81">
                            <span class="text-gray-600">kW</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.01" class="puiss-abs-neg-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="0.81">
                            <span class="text-gray-600">kW</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Simultan√©it√© n√©gatif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="simult-neg-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="102">
                            <span class="text-gray-600">%</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="simult-neg-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="102">
                            <span class="text-gray-600">%</span>
                        </div>
                    </td>
                </tr>
            
                <!-- SECTION MAT√âRIEL CASCADE -->
                <tr class="bg-purple-100 dark:bg-purple-900">
                    <td colspan="3" class="p-2 font-bold text-center text-purple-900 dark:text-purple-100">
                        üîß MAT√âRIEL SP√âCIFIQUE CASCADE
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">√âchangeur de cascade √©quip√©, mont√©</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="echangeur-cascade-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Mont√© et raccord√© sur ch√¢ssis">
                    </td>
                    <td class="p-2">
                        <select class="echangeur-cascade-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                            <option value="">S√©lectionner...</option>
                            <option value="inclus">Inclus</option>
                            <option value="non-inclus">Non inclus</option>
                        </select>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">R√©servoir positif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="reservoir-positif-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="25">
                            <span class="text-gray-600">L</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="reservoir-positif-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="25">
                            <span class="text-gray-600">L</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">R√©servoir n√©gatif</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="reservoir-negatif-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="8">
                            <span class="text-gray-600">L</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" class="reservoir-negatif-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="8">
                            <span class="text-gray-600">L</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Charge ${refrigerantPositif}</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.1" class="charge-r513a-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="8.5">
                            <span class="text-gray-600">L</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.1" class="charge-r513a-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="8.5">
                            <span class="text-gray-600">L</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Charge ${refrigerantNegatif}</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.1" class="charge-r454c-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="3.2">
                            <span class="text-gray-600">L</span>
                        </div>
                    </td>
                    <td class="p-2">
                        <div class="flex items-center space-x-2">
                            <input type="number" step="0.1" class="charge-r454c-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="3.2">
                            <span class="text-gray-600">L</span>
                        </div>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Charge d'huile (2X)</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="charge-huile-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Huile Ester selon fabricant">
                    </td>
                    <td class="p-2">
                        <input type="text" class="charge-huile-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et quantit√©">
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Soupapes double (2X)</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="soupapes-double-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="28 bars double sur vanne tiroir">
                    </td>
                    <td class="p-2">
                        <select class="soupapes-double-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                            <option value="">S√©lectionner...</option>
                            <option value="inclus">Inclus</option>
                            <option value="non-inclus">Non inclus</option>
                        </select>
                    </td>
                </tr>
                <tr class="border-b border-gray-300 dark:border-gray-600">
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-50 dark:bg-blue-900">Mise en service et essais</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-50 dark:bg-blue-900">
                        <input type="text" class="mise-service-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Protocoles complets">
                    </td>
                    <td class="p-2">
                        <select class="mise-service-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                            <option value="">S√©lectionner...</option>
                            <option value="inclus">Inclus</option>
                            <option value="non-inclus">Non inclus</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-100 dark:bg-blue-900">Prix livr√© pos√© HT</td>
                    <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-100 dark:bg-blue-900 text-gray-600 dark:text-gray-400"></td>
                    <td class="p-2 bg-blue-50 dark:bg-blue-800"><input type="text" class="prix-supplier w-full border-0 bg-transparent text-sm font-medium rounded p-1" placeholder="CHF 35'000.00" oninput="formatCHF(this)"></td>
                </tr>
            </tbody>
            `;
        }
        // Charger tableau de validation simplifi√©e pour les autres types
        function loadSimpleValidationTable(productionElement, selectedType) {
            const validationTable = productionElement.querySelector('.validation-table');
            
            const typeInfo = {
                'positif-seul': {
                    title: '‚ùÑÔ∏è PRODUCTION FRIGORIFIQUE POSITIVE SEULE',
                    color: 'blue',
                    specs: {
                        'temp-evap': { label: 'Temp√©rature √©vaporation', value: '-10¬∞C', unit: '¬∞C' },
                        'temp-cond': { label: 'Temp√©rature condensation', value: '45¬∞C', unit: '¬∞C' },
                        'puissance': { label: 'Puissance frigorifique', value: 'Selon calcul', unit: 'kW' },
                        'refrigerant': { label: 'Fluide frigorig√®ne', value: 'R513A', unit: '' }
                    }
                },
                'negatif-seul': {
                    title: 'üßä PRODUCTION FRIGORIFIQUE N√âGATIVE SEULE',
                    color: 'indigo',
                    specs: {
                        'temp-evap': { label: 'Temp√©rature √©vaporation', value: '-30¬∞C', unit: '¬∞C' },
                        'temp-cond': { label: 'Temp√©rature condensation', value: '45¬∞C', unit: '¬∞C' },
                        'puissance': { label: 'Puissance frigorifique', value: 'Selon calcul', unit: 'kW' },
                        'refrigerant': { label: 'Fluide frigorig√®ne', value: 'R454C', unit: '' }
                    }
                },
                'positif-negatif-separes': {
                    title: 'üîÄ CIRCUITS POSITIF + N√âGATIF S√âPAR√âS',
                    color: 'purple',
                    specs: {
                        'temp-evap-pos': { label: 'Temp√©rature √©vaporation positif', value: '-10¬∞C', unit: '¬∞C' },
                        'temp-evap-neg': { label: 'Temp√©rature √©vaporation n√©gatif', value: '-30¬∞C', unit: '¬∞C' },
                        'temp-cond': { label: 'Temp√©rature condensation', value: '45¬∞C', unit: '¬∞C' },
                        'puissance-pos': { label: 'Puissance frigorifique positif', value: 'Selon calcul', unit: 'kW' },
                        'puissance-neg': { label: 'Puissance frigorifique n√©gatif', value: 'Selon calcul', unit: 'kW' }
                    }
                }
            };
            
            const config = typeInfo[selectedType];
            
            validationTable.innerHTML = `
                <thead>
                    <tr class="bg-${config.color}-600 text-white">
                        <th colspan="3" class="p-3 text-center font-bold">
                            ${config.title}
                        </th>
                    </tr>
                    <tr class="bg-gray-100 dark:bg-gray-700">
                        <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Param√®tre</th>
                        <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Valeur sp√©cifi√©e</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">R√©ponse soumissionnaire</th>
                    </tr>
                </thead>
                <tbody class="text-sm">
                    ${Object.entries(config.specs).map(([key, spec]) => `
                        <tr class="border-b border-gray-300 dark:border-gray-600">
                            <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-${config.color}-50 dark:bg-${config.color}-900">${spec.label}</td>
                            <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-${config.color}-50 dark:bg-${config.color}-900">
                                <div class="flex items-center space-x-2">
                                    <input type="text" class="${key}-spec bureau-spec-input w-full border border-gray-300 text-sm rounded p-1" value="${spec.value}">
                                    ${spec.unit ? `<span class="text-gray-600">${spec.unit}</span>` : ''}
                                </div>
                            </td>
                            <td class="p-2">
                                <div class="soumissionnaire-response">
                                    <div class="flex items-center space-x-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" class="accept-spec-checkbox mr-2" onchange="toggleSpecAcceptance(this, '${key}')">
                                            <span class="text-xs">‚úì Spec</span>
                                        </label>
                                        <input type="text" class="${key}-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="${spec.value}">
                                        ${spec.unit ? `<span class="text-gray-600">${spec.unit}</span>` : ''}
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `).join('')}
                    <tr>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-100 dark:bg-blue-900">Prix livr√© pos√© HT</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-100 dark:bg-blue-900 text-gray-600 dark:text-gray-400"></td>
                        <td class="p-2 bg-blue-50 dark:bg-blue-800"><input type="text" class="prix-supplier w-full border-0 bg-transparent text-sm font-medium rounded p-1" placeholder="CHF" oninput="formatCHF(this)"></td>
                    </tr>
                </tbody>
            `;
        }

        // Charger le tableau de validation BOOSTER CO2 - VERSION COMPL√àTE CONFORME AU DOCUMENT LAMA EPFL
        function loadBoosterValidationTable(productionElement) {
            const validationTable = productionElement.querySelector('.validation-table');
            
            validationTable.innerHTML = `
                <!-- üéØ TABLEAU COMPLET BOOSTER CO‚ÇÇ NIVEAU PROFESSIONNEL -->
                <thead>
                    <tr class="bg-green-600 text-white">
                        <th colspan="3" class="p-3 text-center font-bold">
                            üå°Ô∏è CENTRALE FRIGORIFIQUE 3 COMPRESSEURS SEMI-HERM√âTIQUE AU R744 - Descriptif technique complet
                        </th>
                    </tr>
                    <tr class="bg-gray-100 dark:bg-gray-700">
                        <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Crit√®re technique</th>
                        <th class="border-r border-gray-300 dark:border-gray-600 p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">Sp√©cifications bureau d'√©tudes</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 w-1/3">R√©ponse soumissionnaire</th>
                    </tr>
                </thead>
                <tbody class="text-sm">
                    <!-- SECTION G√âN√âRALE -->
                    <tr class="bg-blue-100 dark:bg-blue-900">
                        <td colspan="3" class="p-2 font-bold text-center text-blue-900 dark:text-blue-100">
                            üìã CARACT√âRISTIQUES G√âN√âRALES
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Marque</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="marque-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Libre choix">
                        </td>
                        <td class="p-2">
                            <input type="text" class="marque-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Ex: Bitzer, Dorin, Frascold...">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Dimensions centrale</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="dimensions-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="180 x 120 x 160 cm">
                        </td>
                        <td class="p-2">
                            <input type="text" class="dimensions-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Longueur x Largeur x Hauteur (cm)">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Mat√©riaux</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="materiaux-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Inox / Acier peint RAL au choix">
                        </td>
                        <td class="p-2">
                            <input type="text" class="materiaux-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type de mat√©riaux et finition">
                        </td>
                    </tr>
                
                    <!-- SECTION COMPRESSEURS -->
                    <tr class="bg-green-100 dark:bg-green-900">
                        <td colspan="3" class="p-2 font-bold text-center text-green-900 dark:text-green-100">
                            üîß COMPRESSEURS POSITIFS
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Type compresseur N¬∞1 positif</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="comp-pos-1-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="CD0 38-3.0H">
                        </td>
                        <td class="p-2">
                            <input type="text" class="comp-pos-1-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type exact du compresseur">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Type compresseur N¬∞2 positif</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="comp-pos-2-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="CD0 38-3.0H">
                        </td>
                        <td class="p-2">
                            <input type="text" class="comp-pos-2-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type exact du compresseur">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Type compresseur N¬∞3 positif</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="comp-pos-3-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="CD0 38-3.0H">
                        </td>
                        <td class="p-2">
                            <input type="text" class="comp-pos-3-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type exact du compresseur">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Chauffage carter autor√©gulant</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="chauffage-carter-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Inclus sur tous compresseurs">
                        </td>
                        <td class="p-2">
                            <input type="text" class="chauffage-carter-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et nombre">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Variateur fr√©quence comp. 1</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="variateur-freq-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Inclus compresseur 1">
                        </td>
                        <td class="p-2">
                            <input type="text" class="variateur-freq-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Marque et type">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Protections Kriwan INT69</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="protections-kriwan-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="INT69 sur tous compresseurs">
                        </td>
                        <td class="p-2">
                            <input type="text" class="protections-kriwan-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type de protections">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">R√©gulation niveau huile √©lectronique</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="regulation-huile-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="√âlectronique automatique">
                        </td>
                        <td class="p-2">
                            <input type="text" class="regulation-huile-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type de r√©gulation">
                        </td>
                    </tr>
                
                    <!-- SECTION PERFORMANCES -->
                    <tr class="bg-blue-100 dark:bg-blue-900">
                        <td colspan="3" class="p-2 font-bold text-center text-blue-900 dark:text-blue-100">
                            ‚ö° PERFORMANCES THERMIQUES
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Puissance frigorifique aux compresseurs positif</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" class="puiss-comp-pos-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="15.2" oninput="updateBoosterDisplay(this.closest('.production-item'))">
                                <span class="text-gray-600">kW</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" class="puiss-comp-pos-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="15.2">
                                <span class="text-gray-600">kW</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Puissance frigorifique √† l'√©vaporateur positif</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" class="puiss-evap-pos-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="15.2" oninput="updateBoosterDisplay(this.closest('.production-item'))">
                                <span class="text-gray-600">kW</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" class="puiss-evap-pos-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="15.2">
                                <span class="text-gray-600">kW</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Temp√©rature d'√©vaporation</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="temp-evap-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="-10" oninput="updateBoosterDisplay(this.closest('.production-item'))">
                                <span class="text-gray-600">¬∞C</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="temp-evap-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="-10">
                                <span class="text-gray-600">¬∞C</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Temp√©rature sortie GazCooler</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="temp-gc-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="36" oninput="updateBoosterDisplay(this.closest('.production-item'))">
                                <span class="text-gray-600">¬∞C</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="temp-gc-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="36">
                                <span class="text-gray-600">¬∞C</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Puissance au GazCooler</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" class="puiss-gc-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="11.6" oninput="updateBoosterDisplay(this.closest('.production-item'))">
                                <span class="text-gray-600">kW</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" step="0.1" class="puiss-gc-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="11.6">
                                <span class="text-gray-600">kW</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Fr√©quence max</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="freq-max-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="60" oninput="updateBoosterDisplay(this.closest('.production-item'))">
                                <span class="text-gray-600">Hz</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="freq-max-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="60">
                                <span class="text-gray-600">Hz</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Fr√©quence min</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="freq-min-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="30" oninput="updateBoosterDisplay(this.closest('.production-item'))">
                                <span class="text-gray-600">Hz</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="freq-min-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="30">
                                <span class="text-gray-600">Hz</span>
                            </div>
                        </td>
                    </tr>
                
                    <!-- SECTION PRESSIONS -->
                    <tr class="bg-red-100 dark:bg-red-900">
                        <td colspan="3" class="p-2 font-bold text-center text-red-900 dark:text-red-100">
                            üìä R√âGULATION PRESSIONS CO‚ÇÇ
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Moyenne pression</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="pression-moy-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="38">
                                <span class="text-gray-600">Bar</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="pression-moy-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="38">
                                <span class="text-gray-600">Bar</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Pression HP Max</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="pression-hp-max-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="120" oninput="updateBoosterDisplay(this.closest('.production-item'))">
                                <span class="text-gray-600">Bar</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="pression-hp-max-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="120">
                                <span class="text-gray-600">Bar</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Pression MP Max</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="pression-mp-max-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="60">
                                <span class="text-gray-600">Bar</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="pression-mp-max-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="60">
                                <span class="text-gray-600">Bar</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Pression BP Max</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="pression-bp-max-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="52">
                                <span class="text-gray-600">Bar</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="pression-bp-max-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="52">
                                <span class="text-gray-600">Bar</span>
                            </div>
                        </td>
                    </tr>
                
                    <!-- SECTION VANNES -->
                    <tr class="bg-purple-100 dark:bg-purple-900">
                        <td colspan="3" class="p-2 font-bold text-center text-purple-900 dark:text-purple-100">
                            üîß VANNES SP√âCIFIQUES CO‚ÇÇ
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Vanne modulante MP</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="vanne-mp-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="DANFOSS CCMT">
                        </td>
                        <td class="p-2">
                            <input type="text" class="vanne-mp-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Marque et type">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Vanne modulante HP</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="vanne-hp-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="DANFOSS CCMT">
                        </td>
                        <td class="p-2">
                            <input type="text" class="vanne-hp-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Marque et type">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Vanne m√©canique de secours MP</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="vanne-secours-mp-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="ICS m√©canique">
                        </td>
                        <td class="p-2">
                            <input type="text" class="vanne-secours-mp-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et marque">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Vanne m√©canique de secours HP</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="vanne-secours-hp-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="M√©canique tarage 120 Bar">
                        </td>
                        <td class="p-2">
                            <input type="text" class="vanne-secours-hp-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et tarage">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Vanne d√©part liquide arr√™t d'urgence</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="vanne-urgence-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Belimo motoris√©e">
                        </td>
                        <td class="p-2">
                            <input type="text" class="vanne-urgence-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Marque et type">
                        </td>
                    </tr>
                
                    <!-- SECTION S√âCURIT√âS -->
                    <tr class="bg-red-100 dark:bg-red-900">
                        <td colspan="3" class="p-2 font-bold text-center text-red-900 dark:text-red-100">
                            üõ°Ô∏è S√âCURIT√âS SELON EN378
                        </td>
                    </tr>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Soupapes s√©curit√© selon EN378 (HP,BP,MP)</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                        <input type="text" class="nb-soupapes-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Selon EN378 - tarages adapt√©s par circuit">
                        </td>
                        <td class="p-2">
                            <input type="number" class="nb-soupapes-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Nombre total">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Pressostats HP/MP/BP √©lectroniques digitaux</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="pressostats-digitaux-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Digitaux avec affichage">
                        </td>
                        <td class="p-2">
                            <input type="text" class="pressostats-digitaux-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Marque et type">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Transmetteurs pression (HP,MP,MT)</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="transmetteurs-pression-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="3 transmetteurs 4-20mA">
                        </td>
                        <td class="p-2">
                            <input type="text" class="transmetteurs-pression-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et nombre">
                        </td>
                    </tr>
                
                    <!-- SECTION R√âSERVOIRS -->
                    <tr class="bg-orange-100 dark:bg-orange-900">
                        <td colspan="3" class="p-2 font-bold text-center text-orange-900 dark:text-orange-100">
                            üõ¢Ô∏è R√âSERVOIRS & √âCHANGEURS
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">R√©servoir liquide avec indicateur niveau</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="reservoir-liquide-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Avec indicateur visuel">
                        </td>
                        <td class="p-2">
                            <input type="text" class="reservoir-liquide-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Volume et type">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">S√©parateur d'huile - R√©servoir 60bar</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="separateur-huile-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="R√©servoir 60bar avec s√©parateur">
                        </td>
                        <td class="p-2">
                            <input type="text" class="separateur-huile-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et volume">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Accumulateur aspiration MT</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="accumulateur-mt-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Moyenne temp√©rature inclus">
                        </td>
                        <td class="p-2">
                            <input type="text" class="accumulateur-mt-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et volume">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Ligne Gaz flash/√©changeur r√©g√©n√©ratif</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="ligne-gaz-flash-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="√âchangeur r√©g√©n√©ratif inclus">
                        </td>
                        <td class="p-2">
                            <input type="text" class="ligne-gaz-flash-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et efficacit√©">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Volume du r√©servoir</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="volume-reservoir-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="60">
                                <span class="text-gray-600">L</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="volume-reservoir-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="60">
                                <span class="text-gray-600">L</span>
                            </div>
                        </td>
                    </tr>
                
                    <!-- SECTION FLUIDES -->
                    <tr class="bg-cyan-100 dark:bg-cyan-900">
                        <td colspan="3" class="p-2 font-bold text-center text-cyan-900 dark:text-cyan-100">
                            üß™ FLUIDES & MAT√âRIAUX
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Charge R744 (CO‚ÇÇ)</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="charge-744-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="12">
                                <span class="text-gray-600">kg</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="charge-744-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="12">
                                <span class="text-gray-600">kg</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Charge d'huile PAG RFL68</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="charge-huile-spec bureau-spec-input w-20 border border-gray-300 text-sm rounded p-1" value="12">
                                <span class="text-gray-600">L PAG RFL68</span>
                            </div>
                        </td>
                        <td class="p-2">
                            <div class="flex items-center space-x-2">
                                <input type="number" class="charge-huile-supplier w-20 border-0 bg-transparent text-sm rounded p-1" placeholder="12">
                                <span class="text-gray-600">L</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Conduites inox soud√©</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="conduites-inox-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Inox soud√© selon EN378">
                        </td>
                        <td class="p-2">
                            <input type="text" class="conduites-inox-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et norme">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Isolants sans halog√®ne</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="isolants-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Sans halog√®ne classe B1">
                        </td>
                        <td class="p-2">
                            <input type="text" class="isolants-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et classe">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Ch√¢ssis peint RAL √† choix</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="chassis-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="RAL au choix client">
                        </td>
                        <td class="p-2">
                            <input type="text" class="chassis-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Couleur RAL propos√©e">
                        </td>
                    </tr>
                
                    <!-- SECTION VENTILATION -->
                    <tr class="bg-teal-100 dark:bg-teal-900">
                        <td colspan="3" class="p-2 font-bold text-center text-teal-900 dark:text-teal-100">
                            üí® VENTILATION & DIVERS
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Caisson de ventilation</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="caisson-ventilation-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Inclus avec r√©gulation">
                        </td>
                        <td class="p-2">
                            <input type="text" class="caisson-ventilation-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Type et d√©bit">
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Mise en service et essais</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="mise-service-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Protocoles complets selon EN378">
                        </td>
                        <td class="p-2">
                            <input type="text" class="mise-service-supplier w-full border-0 bg-transparent text-sm rounded p-1" placeholder="Compris/Non compris">
                        </td>
                    </tr>
                    <!-- SECTION MAT√âRIEL SP√âCIFIQUE CO‚ÇÇ -->
                    <tr class="bg-yellow-100 dark:bg-yellow-900">
                        <td colspan="3" class="p-2 font-bold text-center text-yellow-900 dark:text-yellow-100">
                            üî© MAT√âRIEL SP√âCIFIQUE CO‚ÇÇ (selon document LAMA EPFL)
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">√âchangeurs mont√©s sur centrale</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="echangeurs-centrale-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="√âchangeurs int√©gr√©s sur ch√¢ssis">
                        </td>
                        <td class="p-2">
                            <select class="echangeurs-centrale-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                <option value="">S√©lectionner...</option>
                                <option value="inclus">Inclus</option>
                                <option value="non-inclus">Non inclus</option>
                            </select>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Soupapes s√©curit√© sur double vanne tiroir</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="soupapes-double-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Toutes soupapes sur double vanne tiroir">
                        </td>
                        <td class="p-2">
                            <select class="soupapes-double-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                <option value="">S√©lectionner...</option>
                                <option value="inclus">Inclus</option>
                                <option value="non-inclus">Non inclus</option>
                            </select>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Amortisseurs de vibrations</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="amortisseurs-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="4x sous ch√¢ssis + anti-vibrateurs conduites">
                        </td>
                        <td class="p-2">
                            <select class="amortisseurs-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                <option value="">S√©lectionner...</option>
                                <option value="inclus">Inclus</option>
                                <option value="non-inclus">Non inclus</option>
                            </select>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Isolation compl√®te centrale</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="isolation-complete-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Isolation phonique et thermique">
                        </td>
                        <td class="p-2">
                            <select class="isolation-complete-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                <option value="">S√©lectionner...</option>
                                <option value="inclus">Inclus</option>
                                <option value="non-inclus">Non inclus</option>
                            </select>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">D√©tecteurs R744 autonomes (2X)</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="detecteurs-r744-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="1x local machine + 1x ambiance">
                        </td>
                        <td class="p-2">
                            <select class="detecteurs-r744-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                <option value="">S√©lectionner...</option>
                                <option value="inclus">Inclus</option>
                                <option value="non-inclus">Non inclus</option>
                            </select>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-300 dark:border-gray-600">
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-green-50 dark:bg-green-900">Dossier OESP</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-green-50 dark:bg-green-900">
                            <input type="text" class="dossier-oesp-spec bureau-spec-input w-full border-0 bg-transparent text-sm rounded p-1 text-gray-600 dark:text-gray-400" value="Complet selon r√©glementation">
                        </td>
                        <td class="p-2">
                            <select class="dossier-oesp-supplier w-full border-0 bg-transparent text-sm rounded p-1">
                                <option value="">S√©lectionner...</option>
                                <option value="inclus">Inclus</option>
                                <option value="non-inclus">Non inclus</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 font-medium bg-blue-100 dark:bg-blue-900">Prix livr√© pos√© HT</td>
                        <td class="border-r border-gray-300 dark:border-gray-600 p-2 bg-blue-100 dark:bg-blue-900 text-gray-600 dark:text-gray-400"></td>
                        <td class="p-2 bg-blue-50 dark:bg-blue-800"><input type="text" class="prix-supplier w-full border-0 bg-transparent text-sm font-medium rounded p-1" placeholder="CHF 75'000.00" oninput="formatCHF(this)"></td>
                    </tr>
                </tbody>
            `;
        }

        // ‚úÖ FONCTION CORRIG√âE - Synchronisation dynamique BOOSTER CO‚ÇÇ
        function updateBoosterDisplay(productionElement) {
            // R√©cup√©rer les valeurs saisies par l'utilisateur depuis le tableau de validation
            const tempEvap = productionElement.querySelector('.temp-evap-spec')?.value || '';
            const tempGC = productionElement.querySelector('.temp-gc-spec')?.value || '';
            const freqMax = productionElement.querySelector('.freq-max-spec')?.value || '';
            const puissEvap = productionElement.querySelector('.puiss-evap-pos-spec')?.value || '';
            const puissAbs = productionElement.querySelector('.puiss-gc-spec')?.value || '';
            const hpMax = productionElement.querySelector('.pression-hp-max-spec')?.value || '';

            // ‚úÖ SYNCHRONISATION BOOSTER - Mettre √† jour l'affichage en temps r√©el
            const display = productionElement.querySelector('.booster-params-display');
            if (display) {
                const tempEvapDisplay = display.querySelector('.temp-evap-booster-display');
                const tempGCDisplay = display.querySelector('.temp-gc-booster-display');
                const freqMaxDisplay = display.querySelector('.freq-max-booster-display');
                const puissEvapDisplay = display.querySelector('.puiss-evap-booster-display');
                const puissAbsDisplay = display.querySelector('.puiss-abs-booster-display');
                const hpMaxDisplay = display.querySelector('.hp-max-booster-display');

                if (tempEvapDisplay) tempEvapDisplay.textContent = tempEvap ? `${tempEvap}¬∞C` : '-';
                if (tempGCDisplay) tempGCDisplay.textContent = tempGC ? `${tempGC}¬∞C` : '-';
                if (freqMaxDisplay) freqMaxDisplay.textContent = freqMax ? `${freqMax} Hz` : '-';
                if (puissEvapDisplay) puissEvapDisplay.textContent = puissEvap ? `${puissEvap} kW` : '-';
                if (puissAbsDisplay) puissAbsDisplay.textContent = puissAbs ? `${puissAbs} kW` : '-';
                if (hpMaxDisplay) hpMaxDisplay.textContent = hpMax ? `${hpMax} Bar` : '-';
                
                // Valeurs fixes pour BOOSTER CO‚ÇÇ
                const pressionGCDisplay = display.querySelector('.pression-gc-booster-display');
                const simultaneiteDisplay = display.querySelector('.simultaneite-booster-display');
                if (pressionGCDisplay) pressionGCDisplay.textContent = '92 Bar';
                if (simultaneiteDisplay) simultaneiteDisplay.textContent = '88%';
            }
        }

        // Fonction de mise √† jour de l'affichage dynamique CASCADE
        function updateCascadeDisplay(productionElement) {
            // R√©cup√©rer les valeurs saisies par l'utilisateur
            const tempEvapPos = productionElement.querySelector('.temp-evap-pos-spec')?.value || '-';
            const tempEvapNeg = productionElement.querySelector('.temp-evap-neg-spec')?.value || '-';
            const tempCondPos = productionElement.querySelector('.temp-cond-pos-spec')?.value || '-';
            const tempCondNeg = productionElement.querySelector('.temp-cond-neg-spec')?.value || '-';
            const freqMin = productionElement.querySelector('.freq-min-spec')?.value || '-';
            const freqMax = productionElement.querySelector('.freq-max-spec')?.value || '-';
            const puissEvapPos = productionElement.querySelector('.puiss-evap-pos-spec')?.value || '-';
            const puissEvapNeg = productionElement.querySelector('.puiss-evap-neg-spec')?.value || '-';

            // Synchroniser avec l'affichage dynamique
            const display = productionElement.querySelector('.cascade-params-display');
            if (display) {
                display.querySelector('.temp-evap-pos-display').textContent = tempEvapPos ? `${tempEvapPos}¬∞C` : '-';
                display.querySelector('.temp-evap-neg-display').textContent = tempEvapNeg ? `${tempEvapNeg}¬∞C` : '-';
                display.querySelector('.temp-cond-pos-display').textContent = tempCondPos ? `${tempCondPos}¬∞C` : '-';
                display.querySelector('.temp-cond-neg-display').textContent = tempCondNeg ? `${tempCondNeg}¬∞C` : '-';
                display.querySelector('.freq-min-display').textContent = freqMin ? `${freqMin} Hz` : '-';
                display.querySelector('.freq-max-display').textContent = freqMax ? `${freqMax} Hz` : '-';
                display.querySelector('.puiss-evap-pos-display').textContent = puissEvapPos ? `${puissEvapPos} kW` : '-';
                display.querySelector('.puiss-evap-neg-display').textContent = puissEvapNeg ? `${puissEvapNeg} kW` : '-';
            }
        }

        // === NOUVEAU SYST√àME DE COMPRESSEURS DYNAMIQUE - FONCTIONS MANQUANTES AJOUT√âES ===

        // ‚ö†Ô∏è FONCTIONS MANQUANTES CR√â√âES POUR BOOSTER
        function addCompressorBooster(productionElement, circuit) {
            const container = productionElement.querySelector(`.compressors-${circuit}-booster-list`);
            const existingItems = container.querySelectorAll(`.comp-${circuit === 'positif' ? 'pos' : 'neg'}-booster-item`);
            const maxCompressors = 5; // Limite raisonnable
            
            if (existingItems.length >= maxCompressors) {
                showNotification(`‚ùå Maximum ${maxCompressors} compresseurs autoris√©s par circuit`, 'warning');
                return;
            }
            
            const compNumber = existingItems.length + 1;
            const compType = circuit === 'positif' ? 'Bitzer CD0 38-3.0H' : 'Bitzer CD0 25-2.5H';
            
            // Cr√©er le nouvel √©l√©ment
            const newCompItem = document.createElement('div');
            newCompItem.className = `comp-${circuit === 'positif' ? 'pos' : 'neg'}-booster-item`;
            newCompItem.innerHTML = `Comp. #${compNumber}: <strong>${compType}</strong>`;
            
            container.appendChild(newCompItem);
            
            // Mettre √† jour le compteur BOOSTER
            updateCompressorCountBooster(productionElement, circuit);
            
            showNotification(`‚úÖ Compresseur BOOSTER #${compNumber} ajout√© au circuit ${circuit}`, 'success');
        }

        function removeCompressorBooster(productionElement, circuit) {
            const container = productionElement.querySelector(`.compressors-${circuit}-booster-list`);
            const existingItems = container.querySelectorAll(`.comp-${circuit === 'positif' ? 'pos' : 'neg'}-booster-item`);
            
            if (existingItems.length <= 1) {
                showNotification(`‚ùå Minimum 1 compresseur requis par circuit`, 'warning');
                return;
            }
            
            // Retirer le dernier compresseur
            const lastItem = existingItems[existingItems.length - 1];
            lastItem.remove();
            
            // Mettre √† jour le compteur BOOSTER
            updateCompressorCountBooster(productionElement, circuit);
            
            showNotification(`üóëÔ∏è Compresseur BOOSTER retir√© du circuit ${circuit}`, 'success');
        }

        function updateCompressorCountBooster(productionElement, circuit) {
            const container = productionElement.querySelector(`.compressors-${circuit}-booster-list`);
            const existingItems = container.querySelectorAll(`.comp-${circuit === 'positif' ? 'pos' : 'neg'}-booster-item`);
            const display = productionElement.querySelector(`.nb-comp-${circuit === 'positif' ? 'pos' : 'neg'}-booster-display`);
            
            if (display) {
                const count = existingItems.length;
                display.textContent = `${count} compresseur${count > 1 ? 's' : ''}`;
            }
        }

        // Fonction pour ajouter un compresseur (positif ou n√©gatif)
        function addCompressor(productionElement, circuit) {
            const container = productionElement.querySelector(`.compressors-${circuit}-list`);
            const existingItems = container.querySelectorAll(`.comp-${circuit === 'positif' ? 'pos' : 'neg'}-item`);
            const maxCompressors = 5; // Limite raisonnable
            
            if (existingItems.length >= maxCompressors) {
                showNotification(`‚ùå Maximum ${maxCompressors} compresseurs autoris√©s par circuit`, 'warning');
                return;
            }
            
            const compNumber = existingItems.length + 1;
            const compType = circuit === 'positif' ? 'Bitzer CD0 25-2.5H' : 'Bitzer CD0 10.5H';
            
            // Cr√©er le nouvel √©l√©ment
            const newCompItem = document.createElement('div');
            newCompItem.className = `comp-${circuit === 'positif' ? 'pos' : 'neg'}-item`;
            newCompItem.innerHTML = `Comp. #${compNumber}: <strong>${compType}</strong>`;
            
            container.appendChild(newCompItem);
            
            // Mettre √† jour le compteur
            updateCompressorCount(productionElement, circuit);
            
            // Mettre √† jour le tableau de validation CASCADE si applicable
            updateCascadeTableCompressors(productionElement);
            
            showNotification(`‚úÖ Compresseur #${compNumber} ajout√© au circuit ${circuit}`, 'success');
        }

        // Fonction pour retirer un compresseur
        function removeCompressor(productionElement, circuit) {
            const container = productionElement.querySelector(`.compressors-${circuit}-list`);
            const existingItems = container.querySelectorAll(`.comp-${circuit === 'positif' ? 'pos' : 'neg'}-item`);
            
            if (existingItems.length <= 1) {
                showNotification(`‚ùå Minimum 1 compresseur requis par circuit`, 'warning');
                return;
            }
            
            // Retirer le dernier compresseur
            const lastItem = existingItems[existingItems.length - 1];
            lastItem.remove();
            
            // Mettre √† jour le compteur
            updateCompressorCount(productionElement, circuit);
            
            // Mettre √† jour le tableau de validation CASCADE si applicable
            updateCascadeTableCompressors(productionElement);
            
            showNotification(`üóëÔ∏è Compresseur retir√© du circuit ${circuit}`, 'success');
        }

        // Fonction pour mettre √† jour le compteur de compresseurs
        function updateCompressorCount(productionElement, circuit) {
            const container = productionElement.querySelector(`.compressors-${circuit}-list`);
            const existingItems = container.querySelectorAll(`.comp-${circuit === 'positif' ? 'pos' : 'neg'}-item`);
            const display = productionElement.querySelector(`.nb-comp-${circuit === 'positif' ? 'pos' : 'neg'}-display`);
            
            if (display) {
                const count = existingItems.length;
                display.textContent = `${count} compresseur${count > 1 ? 's' : ''}`;
            }
        }

        // Fonction pour mettre √† jour le tableau de validation CASCADE avec les nouveaux compresseurs
        function updateCascadeTableCompressors(productionElement) {
            const typeSelect = productionElement.querySelector('.type-production-input');
            if (!typeSelect || typeSelect.value !== 'cascade') return;
            
            const validationTable = productionElement.querySelector('.validation-table');
            if (!validationTable) return;
            
            // üéØ R√âG√âN√âRATION COMPL√àTE du tableau CASCADE
            console.log('üîÑ R√©g√©n√©ration du tableau CASCADE avec nouveaux compresseurs...');
            
            // R√©cup√©rer les r√©frig√©rants actuels
            const refrigerantPositif = document.getElementById('refrigerantPositif')?.value || 'R513A';
            const refrigerantNegatif = document.getElementById('refrigerantNegatif')?.value || 'R454C';
            
            // Recharger compl√®tement le tableau avec la nouvelle configuration
            loadCascadeValidationTable(productionElement, refrigerantPositif, refrigerantNegatif);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('newProjectBtn').addEventListener('click', createNewProject);
            document.getElementById('saveProjectBtn').addEventListener('click', saveProject);
            document.getElementById('backToProjectsBtn').addEventListener('click', showProjectsList);
            
            // Event listeners pour les boutons d'ajout
            document.getElementById('addChambreBtn').addEventListener('click', addChambre);
            document.getElementById('addRaccordementBtn').addEventListener('click', addRaccordement);  
            document.getElementById('addEvaporateurBtn').addEventListener('click', addEvaporateur);
            document.getElementById('addProductionBtn').addEventListener('click', addProduction);
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    showSection(btn.dataset.section);
                });
            });
            
            // Initialiser la synchronisation automatique des valeurs CASCADE 
            setTimeout(() => {
                // Mettre √† jour l'affichage CASCADE au chargement
                document.querySelectorAll('.production-item').forEach(production => {
                    const typeSelect = production.querySelector('.type-production-input');
                    if (typeSelect && typeSelect.value === 'cascade') {
                        updateCascadeDisplay(production);
                    }
                });
            }, 100);
            
            showProjectsList();
        });
    </script>
</body>
</html>